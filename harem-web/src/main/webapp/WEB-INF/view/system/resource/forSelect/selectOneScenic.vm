<script src="$!{utilWebconfig.getStaticResourcesPath()}/resources/js/page.js" type="text/javascript"></script>
<div>
	<div class="input-group">
		<span class="input-group-addon">景点名称</span>
		<input type="text" class="form-control" name="itemName" id="itemName">
		<span class="input-group-btn"><button class="btn btn-default search" type="button">搜索</button></span>
	</div>
	<div class="input-group selectResourceTable">
	</div>
    <div>
        <span>以选择：</span>
        <span class="checked-resource"></span>
    </div>
	  #*分页*#
	  <div class="pageBar">
      </div>
</div>
<script type="text/javascript">
	var checks = {};
	$(".search").click(function() {
		pageUtils.request(1, $(".pageSize").val(),{name:$("#itemName").val()});
	});
	function initTable() { 
    	$('table.resourceTable').datatable({
    		checkable: false
    	});
		$(".item-radio").click(function() {
			$(".checked-resource").empty();
    		if($(".item-radio:checked").length > 0) {
				var rId = $(".item-radio:checked").attr("rId");
				var rName = $(".item-radio:checked").attr("rName");
				var rData = $(".item-radio:checked").attr("rData");
				var btn = $("<button class='btn btn-info resources'></button>");
				// check
				btn.attr("id","result_item");
				btn.attr("rId",rId);
				btn.attr("rName",rName);
				btn.attr("rData",rData);
				btn.text(rName);
				$(".checked-resource").append(btn);
			}
		});
	}
	// 初始化分页条
	pageUtils.intall(".pageBar", "$!{utilWebconfig.getActionDefaultFontPath()}/B2C/resourceForSelect/queryScenicForSelect", function(query, pageVo){
		$("#itemName").val(query.name);
		showData(pageVo.itemList);
	});
	function showData(itemList) {
		$(".selectResourceTable").empty();
		var table = $("<table class='table table-striped table-hover resourceTable'/>");
		table.append("<thead><tr><th>选择</th><th>景点名称</th><th>状态</th></tr></thead>");
        var tbody = $("<tbody/>");
		table.append(tbody);
		for(i in itemList) {
			var item = itemList[i];
			var tr = $("<tr id='resource_"+item.id+"_"+item.name+"'></tr>");
			tr.append($("<td><input type='radio' class='item-radio' name='item' id='radio_"+item.id+"' rId='"+item.id+"' rName='"+item.name+"' rData='"+JSON.stringify(item)+"'/></td>"));
			tr.append($("<td>"+item.name+"</td>"));
			tr.append($("<td>"+item.status+"</td>"));
			tbody.append(tr);
		}
		$(".selectResourceTable").append(table);
		// 初始化特效
		initTable();
		// 已经选择的打上标记
		$(".resources").each(function(){
			var rId = $(this).attr("rId");
			var rName = $(this).attr("rName");
			$("input[id='radio_"+rId+"']").attr("checked", "checked");
		});
	}
	// 获得最终结果
	function getItem() {
		if($("#result_item").length > 0) {
			var rData = $("#result_item").attr("rData");
			return JSON.parse(rData);
		} else {
			return null;
		}
	}
</script>