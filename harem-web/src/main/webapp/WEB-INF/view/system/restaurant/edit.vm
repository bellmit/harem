<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/layerModal.js" type="text/javascript"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/map.js" type="text/javascript"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.all.min.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/lang/zh-cn/zh-cn.js"></script>
<style type="text/css">
    .demo {
        width: 850px;
        margin: 20px auto;
        display: none;
    }

    #l-map {
        height: 400px;
        width: 600px;
        float: left;
        border: 1px solid #bcbcbc;
    }

    #r-result {
        height: 400px;
        width: 230px;
        float: right;
    }
</style>

<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<div class="example whole">
<form id="restaurantForm">
    <ul id="myTab" class="nav nav-tabs">
        <li class="active">
            <a href="#restaurantInfo" data-toggle="tab">餐厅信息</a>
        </li>
        <li>
            <a href="#restaurantDetailDiv" data-toggle="tab">餐厅详情</a>
        </li>
        <li>
            <a href="#restaurantImgs" data-toggle="tab">图片集</a>
        </li>
    </ul>
    <div class="tab-content grogInfoWrap" style="">
        <div class="tab-pane active" id="restaurantInfo">
            <div class="createHotrlTable">
                <table class="table">
                    <tbody>
                    <tr>
                        <td><span class="spColor">*</span>餐厅名称</td>
                        <td>
                            #if($!{VO.scenic.id})
                                <input type="hidden" name="id" value="$!{VO.scenic.id}">
                            #end
                            <input type="text" class="inpCtlBlock" name="name" id="name" placeholder="请输入20个字以内"
                                   value="$!{VO.scenic.name}"></td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>区域</td>
                        <td>
                            <div class="selectList">
                                
                           
                            <input type="hidden" id="provinceSelectName" name="locationProvinceName" value="$!{VO.scenic.locationProvinceName}">
                            <select id="provinceId" class="selCity inpControl provinceSelect" name="scenic.locationProvinceId" areaType="PROVINCE">
                                <option value="$!{VO.scenic.locationProvinceId}">#if(! $VO.scenic.locationProvinceName)请选择省份#else$!{VO.scenic.locationProvinceName}#end</option>
                            </select>
                            <input type="hidden" id="citySelectName" name="locationCityName" value="$!{VO.scenic.locationCityName}">
                            <select id="cityId" class="selCity inpControl citySelect" name="scenic.locationCityId" areaType="CITY">
                                <option value="$!{VO.scenic.locationCityId}">#if(! $VO.scenic.locationCityName)请选择城市#else$!{VO.scenic.locationProvinceName}#end</option>
                            </select>
                            <input type="hidden" id="countySelectName" name="locationTownName" value="$!{VO.scenic.locationTownName}">
                            <select id="countyId" class="selCity inpControl countySelect" name="scenic.locationTownId" areaType="COUNTY">
                                <option value="$!{VO.scenic.locationTownId}">#if(! $VO.scenic.locationTownName)请选择区县#else$!{VO.scenic.locationTownName}#end</option>
                            </select>	
                                <input type="text" class="inpControl" name="locationText" id="locationText"
                                       placeholder="请输入100个字以内" value="$!{VO.scenic.locationText}">
                           
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>地址经纬度</td>
                        <td><span>经度</span><input type="text" name="locationX" id="locationX"
                                                  class="inpControl getAddress" value="$!{VO.scenic.locationX}">
                            <span>维度</span><input type="text" name="locationY" id="locationY"
                                                  class="inpControl getAddress" value="$!{VO.scenic.locationY}">
                            <button type="button" class="btn btn-primary locationXYSelectBtn">查找经纬度</button>
                            <code>点击查找经纬度可自动获取</code></td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>餐厅简介</td>
                        <td><textarea name="oneword" id="oneword" rows="3" class="form-control"
                                      placeholder="请输入500字以内">$!{VO.scenic.oneword}</textarea></td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>特色描述</td>
                        <td><textarea name="description" id="description" rows="3" class="form-control"
                                      placeholder="请输入500字以内">$!{VO.scenic.description}</textarea></td>
                    </tr>

                    <tr>
                        <td>餐厅联系人</td>
                        <td>
                            <span>姓名</span><input type="text" name="contactPerson" class="inpControl"
                                                  value="$!{VO.scenic.contactPerson}">
                            <span>电话</span><input type="text" name="contactPhone" class="inpControl"
                                                  value="$!{VO.scenic.contactPhone}">
                        </td>
                    </tr>
                    <tr>
                        <td>推荐理由</td>
                        <td>
                            <button type="button" class="btn btn-info selectUser">选择旅游咖</button>
                      		  <input type="text" name="title"  class="inpControl"
                                   value="#if(! $recommend.title)大咖推荐#else$!recommend.title#end">
                            <img src="#if($recommend.userPic) $utilWebconfig.getTfsRootPath()$!recommend.userPic  #end"
                                 alt="头像" class="img-circle grogUserLogo" id="userImg">
                                 <span id="recommendNameT"></span>
                            <textarea name="description" id="recommend" rows="3" class="form-control"
                                      placeholder="请输入300字以内">$!{recommend.description}</textarea>
                            <input type="hidden" id="recommendId" name="id" value="$!{recommend.id}" >
                            <input type="hidden" id="recommendUserId" name="userId" value="$!{recommend.userId}" >
                            <input type="hidden" id="recommendUserPic" name="userPic" value="$!{recommend.userPic}" >
                            <input type="hidden" id="recommendName" name="name2" value="$!{recommend.name}" >
                        </td>
                    </tr>
					
                    </tbody>
                </table>
            </div>
        </div>
        <div class="tab-pane" id="restaurantDetailDiv">
            <script type="text/javascript">
                $(function() {
                    window.UEDITOR_HOME_URL = "/resources/ueditor/";
                    var ue = UE.getEditor('editor');
                });
            </script>
            <script id="editor" type="text/plain" name="needKnow.extraInfoUrl" style="width: 100%; height:350px">$!{VO.needKnow.extraInfoUrl}</script>
        </div>
        <div class="tab-pane" id="restaurantImgs">
				 #parse("/system/scenicSpot/picture.vm")
        </div>
    </div>

    <button type="submit" class="btn btn-info">保存</button>
</form>
</div>

<script>

    var mapCallback = function (data) {
        if (data) {
            $("#locationX").val(data['pointX']);
            $("#locationY").val(data['pointY']);
        }
    }
 	var tfsPath = '$utilWebconfig.getTfsRootPath()';
    $(function () {
    	  /*弹出框{"description":"大咖推荐","id":0,"name":"YOYO","user_id":1,"user_pic":"T1SRhTByYT1R17cSCrK"}
    	  {"id":331,"userId":7606,"nickName":"测试","options":2,"avatar":"T1SRhTByYT1R17cSCrK"}
    	  **/
       $('.selectUser').click(function(){
         	openModalForForm(actionDefaultPath + '/B2C/resourceForSelect/selectOneTravelKa','选择大咖',function() {
				var ka = win.getTravelKa();
				if(ka == null) return;
				$("#recommendName").val(ka.nickName);
				$("#userImg").attr('src',tfsPath + ka.avatar);
				$("#recommendId").val(ka.id);
				$("#recommendUserId").val(ka.userId);
				$("#recommendUserPic").val(ka.avatar);
				$("#recommendNameT").html(ka.nickName);
				return true;
			});
        })
        
        
        
    var provinceFlag = false;
	var cityFlag = false;
	var areaFlag = false;
	
 
		$.ajaxSetup({
			async : false
		});
		$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': 'PROVINCE',
					 'areaParentCode': null}, 
					function(data) {
						if (data[0].name) {						
							for (var i in data) {								
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#provinceId").append(optionHTML);								
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
					
		$('.provinceSelect').click(function() {
			
			if (provinceFlag) {
				return;
			}
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': $(this).attr("areaType"),
					 'areaParentCode': null}, 
					function(data) {
						if (data[0].name) {
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#provinceId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
		});
        //地址选择
        $('.provinceSelect').change(function(){            
			
			if($('.provinceSelect option:selected')){
                $('#provinceSelectName').val($('.provinceSelect option:selected').text());
            }
			
			//清空所有子元素
			if (parseInt($("#cityId").children().length) > 1) {
				$("#cityId").empty();
				$("#cityId").append('<option value="">请选择城市</option>');
			}
				//清空所有子元素
			if (parseInt($("#countyId").children().length) > 1) {
				$("#countyId").empty();
				$("#countyId").append('<option value="">请选择城市</option>');
			}
			
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': 'CITY',
					 'areaParentCode': $('.provinceSelect option:selected').attr("value")}, 
					
					function(data) {
						if (data[0].name) {
							
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#cityId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
			
        });
        $('.citySelect').change(function(){
            if($('.citySelect option:selected')){
                $('#citySelectName').val($('.citySelect option:selected').text());
            }
            
            	//清空所有子元素
			if (parseInt($("#countyId").children().length) > 1) {
				$("#countyId").empty();
				$("#countyId").append('<option value="">请选择城市</option>');
			}
			
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': 'COUNTY',
					 'areaParentCode': $('.citySelect option:selected').attr("value")}, 
					
					function(data) {
						if (data[0].name) {
							
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#countyId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
        });
        
        $('.countySelect').change(function(){
            
			if($('.countySelect option:selected')){
                $('#countySelectName').val($('.countySelect option:selected').text());
            }
						
        });	       
    
		/*
    	$(document).delegate('#logoUrlUploadFile','change',function(){
            $.ajaxFileUpload
            (
                    {
                 		url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'logoUrlUploadFile', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                               
                                $('#logoUrlUploadFileReturnInput').val(data.data);
                                $('#logoUrlUploadFileReturnImg').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
        
        
        $(document).delegate('#logoUrlUploadFile1','change',function(){
            $.ajaxFileUpload
            (
                    {
                 		url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'logoUrlUploadFile1', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                             
                                $('#logoUrlUploadFileReturnInput1').val(data.data);
                                $('#logoUrlUploadFileReturnImg1').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
        */          

        $('.locationXYSelectBtn').click(function () {
            openBaiduMap(115.727899, 37.723961, mapCallback);
        });
        
      	        /*提交**/
        $("#restaurantForm").validate({
            rules: {
                'name': {
                    required: true
                }
            },
            messages: {
                'scenic.name': {
                    required: "请填写"
                }
            },
            errorPlacement: function (error, element) { // 指定错误信息位置

                if (element.is(':radio') || element.is(':checkbox')
                        || element.is(':input')) { // 如果是radio或checkbox
                    var eid = element.attr('name'); // 获取元素的name属性
                    error.appendTo(element.parent()); // 将错误信息添加当前元素的父结点后面
                } else {
                    error.insertAfter(element);
                }
            },
            submitHandler: function (form) {
                var options = {
                    url: actionDefaultPath + "/B2C/resourceManage/restaurant/save",
                    type: "post",
                    dataType: "json",
                    success: function (data) {
                        if (data.status == 200) {
							layer.alert('操作成功');
                            //location.href = actionDefaultPath + "/B2C/resourceManage/restaurant/list2";
							setTimeout(function(){
            					var tabId = top.$(".tab-pane.active").attr("id");
            					top.$("#myTabList li").each(function(){
                					if($(this).attr("dataid") == tabId){
                    					$(this).prev().addClass("active");
                    					$(this).remove();
                					}
            					});
            					top.freshPrevFrame();
            					top.$("#"+tabId).prev().addClass("active");
            					top.$("#"+tabId).prev().show();
            					top.$("#"+tabId).remove();
        					},2000);
							//setTimeout('location.href = actionDefaultPath + "/B2C/resourceManage/restaurant/list"', 2000);
                        } else {
                            $("#clubCategorySubmit").attr("disabled", false);
                            layer.alert('操作失败');
							//setTimeout('location.href = actionDefaultPath + "/B2C/resourceManage/restaurant/list"', 2000);
							setTimeout(function(){
            					var tabId = top.$(".tab-pane.active").attr("id");
            					top.$("#myTabList li").each(function(){
                					if($(this).attr("dataid") == tabId){
                    					$(this).prev().addClass("active");
                    					$(this).remove();
                					}
            					});
            					top.freshPrevFrame();
            					top.$("#"+tabId).prev().addClass("active");
            					top.$("#"+tabId).prev().show();
            					top.$("#"+tabId).remove();
        					},2000);                            
                        }
                    }
                };

                $(form).ajaxSubmit(options);
            },
            invalidHandler: function (form, validator) { // 不通过回调
                return false;
            }
        });

        
    });
</script>