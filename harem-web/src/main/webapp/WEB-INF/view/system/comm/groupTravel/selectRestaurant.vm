<script src="$!{staticResourcesPath}/resources/js/json2.js" type="text/javascript"></script>
<script src="$!{staticResourcesPath}/resources/js/page.js" type="text/javascript"></script>
<div>
	<div class="input-group">
		<span class="input-group-addon">餐厅名称</span>
		<input type="text" class="form-control" name="name" id="name" value="$!query.name">
		<span class="input-group-btn"><button class="btn btn-default" type="button">搜索</button></span>
	</div>
	<div class="input-group selectRestaurantTable">
	</div>
    <div>
        <span>以选择：</span>
        <span class="checked-restaurant"></span>
    </div>
	  #*分页*#
	  <div class="pageBar">
      </div>
</div>
<script type="text/javascript">
 //<form id="selectRestaurantForm" action="$!actionDefaultPath/B2C/comm/groupTravel/selectRestaurant" method="get">
	var checks = {};
	function initTable() { 
    	$('table.restaurantTable').datatable({
    		checkable: true,
    		checksChanged: function(event) {
    			// 取消的删除
				$(".restaurantTable tbody tr").each(function() {
    				var data_id = $(this).attr("id");
					var str = data_id.split("_");
    				if(event.checks.checks.indexOf(data_id)==-1) {
    					$("#r_"+str[1]).remove();
    				}
    			});
    			// 新增的添加
    			$(event.checks.checks).each(function() {
    				var str = this.split("_");
    				if($("#r_"+str[1]).length <= 0) {
        				var btn = $("<button class='btn btn-primary restaurants'></button>");
        				// check 
    					btn.click(function(){
    						$("tr[data-id^='restaurant_"+$(this).attr("rId")+"_']").removeClass("active");
        					$(this).remove();
        				});
        				btn.attr("id","r_"+str[1]);
        				btn.attr("rId",str[1]);
        				btn.attr("rName",str[2]);
        				btn.text(str[2]);
        				$(".checked-restaurant").append(btn);
    				} 
    			});
    		}
    	});
	}
	// 初始化分页条
	pageUtils.intall(".pageBar", "$!{actionDefaultPath}/B2C/comm/groupTravel/queryRestaurantForSelect", function(query, pageVo){
		showData(pageVo.itemList);
	});
	function showData(itemList) {
		$(".selectRestaurantTable").empty();
		var table = $("<table class='table table-striped table-hover restaurantTable'/>");
		table.append("<thead><tr><th>餐厅名称</th><th>状态</th></tr></thead>");
        var tbody = $("<tbody/>");
		table.append(tbody);
		for(i in itemList) {
			var item = itemList[i];
			var tr = $("<tr id='restaurant_"+item.id+"_"+item.name+"'></tr>");
			tr.append($("<td>"+item.name+"</td>"));
			tr.append($("<td>"+item.state+"</td>"));
			tbody.append(tr);
		}
		$(".selectRestaurantTable").append(table);
		// 初始化特效
		initTable();
		// 已经选择的打上标记
		$(".restaurants").each(function(){
			var rId = $(this).attr("rId");
			var rName = $(this).attr("rName");
			$("tr[data-id^='restaurant_"+rId+"_']").addClass("active");
		});
	}
	// 获得最终结果
	function getRestaurant() {
		var result = [];
		$(".restaurants").each(function(){
			var rId = $(this).attr("rId");
			var rName = $(this).attr("rName");
			result.push({id:rId,name:rName});
		});
		return result;
	}
</script>