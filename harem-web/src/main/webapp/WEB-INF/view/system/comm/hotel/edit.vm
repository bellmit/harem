<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/layerModal.js"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/upload.js"></script>
<div class="example whole">
    <form name="commHotelForm" id="commHotelForm" action="" method="post" commHotelId="$!commHotel.id">
            <div class="">
                <table class="table">
                    <input type="hidden" name="categoryId" value="$!category.id">
                    <input type="hidden" name="rootCategoryId" value="$!category.parent.id">
                #*商品类型，此页面全是酒店商品发布 新增的时候需要，修改的时候不更新此字段*#
                    <input type="hidden" name="itemType" value="$!itemType">
                #*pay_type 暂时设置为1*#
                    <input type="hidden" name="payType" value="1">
                #*source 来源暂时都为1*#
                    <input type="hidden" name="source" value="1">

                #*version 新增时为1*#
                    <input type="hidden" name="version" value="#if($!commHotel.version)$!commHotel.version#else 1#end">
                #*有没有sku*#
                    <input type="hidden" name="options" value="0">
                    <tr>
                        <td><span class="spColor">*</span>分类</td>
                        <td>
                            酒店
                        </td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>酒店</td>
                        <td>
                            <button type="button" class="btn btn-info selectHotelBtn">选择酒店</button>
                            <span class="hotelName">$!commHotel.subTitle</span>
                            <input class="hotelNameInp" type="hidden" name="subTitle" value="$!commHotel.subTitle">
                            <input class="hotelIdInp" type="hidden" name="outId" value="$!commHotel.outId">
                        </td>
                    </tr>
                    <tr>
                        <td><span class="spColor">*</span>排序</td>
                        <td><input type="text" name="sort" value="$!commHotel.sort" >请输入数字，数字越大排序靠后</td>
                    </tr>
                    <tr>
                        <td>*时间区间</td>
                        <td>用户可选入住时间为<input type="text" name="startBookTimeLimit" value="$!commHotel.startBookTimeLimit">天内</td>
                    </tr>
                </table>
            </div>
            <div class="">
                <table class="table table-hover">
                    <tr>
                        <th>商品名称</th>
                        <th>说明</th>
                        <th>单价</th>
                        <th>会员优惠额度</th>
                        <th>会员限购</th>
                        <th>图片</th>

                    </tr>
                        <tr class="subCheckedTR">
                            <td><input type="text" name="title" value="$!commHotel.title"></td>
                            <td><input type="text" name="oneWord" value="$!commHotel.oneWord"></td>
                            <td><input type="text" name="priceY" value="$!commHotel.priceY"></td>
                            <td><input type="text" name="" value=""></td>
                            <td><input type="text" name="" value=""></td>
                            <td class="picUrlsTd">
                                <input id="batchUploadBtn" type="file" multiple="multiple" >
                                #foreach($pic in $!commHotel.picUrlList)
                                    <img class="picUrlsUrl" src="$utilWebconfig.getTfsRootPath()$pic">
                                #end
                                <input class="picUrlsVal" type="hidden" name="picUrls" value="$!commHotel.picUrls">
                            </td>
                        </tr>
                </table>
            </div>
            <div class="clubBotBtn">
                <div class="btn-group">
                    <button class="btn btn-success" type="button" id="btnSubmit" >添加</button>
                </div>
                <div class="btn-group">
                    <button type="button"  class="btn closBtn">取消</button>
                </div>
            </div>
        <div class="">
            #if($!commHotel.id)
                <table class="table">
                    <tbody>
                    <tr>
                        <td>创建时间</td>
                        <td>
                            $!utilDate.dateToString($!commHotel.gmtCreated,"yyyy-MM-dd HH:mm:ss")
                        </td>
                    </tr>
                    <tr>
                        <td>更新时间</td>
                        <td>
                            $!utilDate.dateToString($!commHotel.gmtModified,"yyyy-MM-dd HH:mm:ss")
                        </td>
                    </tr>
                </table>
            #end
        </div>
    </form>
</div>
<script>

    var batchCallBack = function(dataVal){

        if(dataVal && dataVal.status == 200){
            for(var key in dataVal.data){
                $('.picUrlsTd').append('<img class="picUrlsUrl" imgUrl="' + dataVal.data[key]+'" src="' + tfsRootPath + dataVal.data[key]+'" alt="">');
            }
        }else{
            layer.msg('图片上传失败，请重试', {icon: 2});
        }
    }

    $(function(){
        /****************批量上传pic_urls*****************/
        $(document).delegate("#batchUploadBtn",'change',function(){
            fileUpload('#batchUploadBtn',2,batchCallBack);
        })

        $(".selectHotelBtn").click(selectHotel);
        // 选择酒店
        function selectHotel(){
            currentHId = $(this).attr("display-id");
            openModalForForm('$!{utilWebconfig.getActionDefaultFontPath()}/B2C/resourceForSelect/selectHotel','选择酒店 ',function() {
                var hot = win.getItems();
                if(hot && hot[0]){
                    $('.hotelName').text(hot[0]['name']);
                    $('.hotelIdInp').val(hot[0]['id']);
                    $('.hotelNameInp').val(hot[0]['name']);
                }else{

                    //return false;
                }
                //console.log(JSON.stringify(hot));
                //一般设定yes回调，必须进行手工关闭
                return true;
            });
        }
        //提交
        $('#btnSubmit').click(function(){
            $(this).prop('disabled',true);
            //图片列表
            var picUrls = '';
            $('.picUrlsUrl').each(function(){
                if(picUrls){
                    picUrls += '|' + $(this).attr('imgUrl');
                }else{
                    picUrls += $(this).attr('imgUrl');
                }
            });
            $('.picUrlsVal').val(picUrls);
            var actionUrl;
            var commHotelId = $('#commHotelForm').attr('commHotelId');
            if(commHotelId){
                actionUrl = actionDefaultPath + '/B2C/comm/hotelManage/edit/' + commHotelId;
            }else{
                actionUrl = actionDefaultPath + '/B2C/comm/hotelManage/add';
            }
            $('#commHotelForm').attr('action',actionUrl);
            $('#commHotelForm').submit();
        });

        $('.closBtn').click(function(){
            window.close();
        });

    });
</script>