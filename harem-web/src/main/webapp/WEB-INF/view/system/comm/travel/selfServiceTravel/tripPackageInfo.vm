 <script src="$!{utilWebconfig.getStaticResourcesPath()}/resources/js/layerModal.js" type="text/javascript"></script>
 <div>
	<div class='panel add-fight'>
		<div class='panel-heading'><i class='icon icon-2x icon-home'></i>航班信息</div>
		<div class='panel-body'>
			<table class="table">
				<tr>
					<td>
						<div>
							<input type="radio" value="0" id="no-flight" name="has-flight" #if(${product.tripPackageInfo.hasFlight}!=1) checked #end><label for="no-flight">无航班信息</label>
                        </div>
						<div>
							<button class='btn btn-primary set-flight'>填写航班信息</button>
						</div>
						<div class="flight-info">
						#if($product.tripPackageInfo.flightInfo)
							<div class="flight">
								<div><input type="text" class="flight-info-data" value="$product.tripPackageInfo.flightInfo.toString()"/></div>
								<button class="btn btn-primary remove-parent">删除</button>
							</div>
						#end
						</div>
                    </td>
					<td>
						<div>
							<input type="radio" value="1" id="has-flight" name="has-flight" #if(${product.tripPackageInfo.hasFlight}==1) checked #end><label for="has-flight">有航班信息</label>
                        </div>
						<div>
							<button class='btn btn-primary add-flight'>添加航班信息</button>
						</div>
						<div class="flights">
						#foreach($flight in $product.tripPackageInfo.flights)
							<div class="flight">
								<div><input type="text" class="flight-date" value="$flight.toString()"/></div>
								<button class="btn btn-primary remove-parent">删除</button>
							</div>
						#end
						</div>
                    </td>
                </tr>
            </table>
		</div>
	</div>
	<div class='panel add-hotel'>
		<div class='panel-heading'><i class='icon icon-2x icon-home'></i>添加酒店</div>
		<div class='panel-body hotel' id='day_hotel'>
		#foreach($hotel in $product.tripPackageInfo.hotels)
			<button class="btn btn-info remove-self" rid="$!{hotel.id}" rname="$!{hotel.name}">$!{hotel.name}</button>
		#end
		</div>
		<button class='btn btn-primary select-hotel'>选择酒店</button>
	</div>
</div> 
<script type="text/javascript">
	$(".set-flight").click(setFlightInfo);
	$(".add-flight").click(selectFlight);
	$(".select-hotel").click(selectHotel);
	function removeSelf() {
		$(this).remove();
	}
	$(".remove-self").click(removeSelf);
	function removeParent(){
		$(this).parent().remove();
	}
	$(".remove-parent").click(removeParent);
	// 添加航班
	function selectFlight(){
		openModalForForm(actionDefaultPath + '/B2C/comm/selfServiceTravel/addFlight','添加航班 ',function() {
			var flights = win.getFlights();
			// console.log(JSON.stringify(flights));
			var content = $(".flights");
			// 数据绑定点：开始
			var data = $("<input type='text' class='flight-data'>");
			data.val(JSON.stringify(flights.go));
			data = $("<div/>").append(data);
			var del_btn = $("<button class='btn btn-primary remove-parent'>删除</button>");
			del_btn.click(removeParent);
			content.append($("<div class='flight'/>").append(data).append(del_btn));
			// 数据绑定点：结束
			//一般设定yes回调，必须进行手工关闭
			return true;
		});
	}
	// 填写航班
	function setFlightInfo(){
		openModalForForm(actionDefaultPath + '/B2C/comm/selfServiceTravel/addFlight','添加航班 ',function() {
			var flights = win.getFlights();
			// console.log(JSON.stringify(flights));
			var content = $(".flight-info");
			content.empty();
			// 数据绑定点：开始
			var data = $("<input type='text' class='flight-info-data'>");
			data.val(JSON.stringify(flights));
			data = $("<div/>").append(data);
			var del_btn = $("<button class='btn btn-primary remove-parent'>删除</button>");
			del_btn.click(removeParent);
			content.append($("<div class='flight'/>").append(data).append(del_btn));
			// 数据绑定点：结束
			//一般设定yes回调，必须进行手工关闭
			return true;
		});
	}
	// 选择酒店
	function selectHotel(){
		openModalForForm(actionDefaultPath + '/B2C/resourceForSelect/selectHotel','选择酒店 ',function() {
			var hot = win.getItems(); 
			var content = $("#day_hotel");
			content.empty();
            for(var i in hot) {
				var btn = $("<button class='btn btn-info hotel_item'></button>");
				btn.attr("rId", hot[i].id);
				btn.attr("rName", hot[i].name);
				btn.click(function() {
					$(this).remove();
				});
				content.append(btn.text(hot[i].name));
			}
			//console.log(JSON.stringify(hot));
			//一般设定yes回调，必须进行手工关闭
			return true;
		});
    }
	function getTripPackageInfo(){
		var result = {};
		var flight_status = $("[name='has-flight']:checked").val();
		result["hasFlight"] = flight_status;
		if(flight_status == 0) {
			result["flightInfo"] = JSON.parse($(".flight-info-data").val());
		} else {
			var flights = [];
			$(".flight-date").each(function() {
				flights.push(JSON.parse($(this).val()));
			});
			result["flights"] = flights;
		}
		// 酒店
		var hotels = [];
		$(".hotel_item").each(function(){
			var rId = $(this).attr("rId");
			var rName = $(this).attr("rName");
			hotels.push({id:rId,name:rName});
		});
		result["hotels"] = hotels;
		return result;
	}
</script>