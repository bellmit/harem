<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/common.css"/>
<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<div class="createClubTable whole">
    <form name="addClub" id="clubForm" action="" method="post" clubId="$!club.id">
        <table class="table">
            <tr>
                <td><span class="spColor">*</span>俱乐部名称</td>
                <input type="hidden" class="form-control" name="id" value="$!club.id">
                <td><input type="text" class="form-control" placeholder="请输入20个字以内" name="name" value="$!club.name"></td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>俱乐部LOGO</td>
                <td>
                    <div class="fileImg">
                        <button type="button" class="btn btn-success">选择图片</button>
                        <input type="hidden" name="logoUrl" value="$!club.logoUrl" id="logoUrlUploadFileReturnInput" >
                        <input type="file" name="file" class="fileInp" id="logoUrlUploadFile">
                        <p>注：图片大小不超过5M<br />建议尺寸：300*300</p>
                    </div>
                    <div class="logoView">
                        <img src="#if($club.logoUrl) $utilWebconfig.getTfsRootPath()$!club.logoUrl #end" class="img-circle" id="logoUrlUploadFileReturnImg">
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>俱乐部宣传图</td>
                <td>
                    <div class="fileImg">
                        <button type="button" class="btn btn-success">选择图片</button>
                        <input type="hidden" name="picturePoster" value="$!club.picturePoster"  id="picturePosterUploadFileReturnInput">
                        <input type="file"  name="file" class="fileInp" id="picturePosterUploadFile">
                        <p>注：图片大小不超过5M<br />建议尺寸：687*237</p>
                    </div>
                    <div class="propagandaView">
                        <img src="#if($club.picturePoster) $utilWebconfig.getTfsRootPath()$!club.picturePoster  #end" id="picturePosterUploadFileReturnImg">
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>成员限额</td>
                <td><input type="text" class="form-control" placeholder="请输入数字" name="limitNum" value="$!club.limitNum"></td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>部长</td>
                <td>
                    <div class="userBtn">
                        <button type="button" class="btn btn-info">选择用户</button>
                        <input type="hidden" name="manageUserName" value="$!club.manageUserName">
                        <input type="hidden" name="manageUserLogoUrl" value="$!club.manageUserLogoUrl">
                    </div>
                    <div class="userView">
                        <img src=" #if($club.manageUserLogoUrl) $utilWebconfig.getTfsRootPath()$!club.manageUserLogoUrl  #end">
                        #*TODO*#
                        <span>Tracy</span>
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>排序</td>
                <td><input type="text" class="form-control" placeholder="请输入数字，数字越大排序靠后" name="sequenceNum" value="$!club.sequenceNum"></td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>状态</td>
                <td class="radioSel">
                    <div class="col-md-10">
                        <label class="radio-inline"> <input type="radio" name="joinStatus" value="1" #if($!club.joinStatus == 1) checked #end> 允许加入 </label>
                        <label class="radio-inline"> <input type="radio" name="joinStatus" value="0" #if($!club.joinStatus == 2) checked #end> 禁止加入 </label>
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>前台显示</td>
                <td class="radioSel">
                    <div class="col-md-10">
                        <label class="radio-inline"> <input type="radio" name="showStatus" value="1" #if($!club.showStatus == 1) checked #end> 显示 </label>
                        <label class="radio-inline"> <input type="radio" name="showStatus" value="0" #if($!club.showStatus == 2) checked #end> 隐藏 </label>
                    </div>
                </td>
            </tr>
        </table>
        <div class="clubBotBtn">
            <div class="btn-group">
                <button class="btn btn-success" type="button" id="btnSubmit" >添加</button>
            </div>
            <div class="btn-group">
                <button class="btn">取消</button>
            </div>
        </div>
    </form>
</div>
<script>


    $(function(){
        $(document).delegate('#logoUrlUploadFile','change',function(){
            $.ajaxFileUpload
            (
                    {
                        url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'logoUrlUploadFile', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                                var tfsPath = '$utilWebconfig.getTfsRootPath()';
                                $('#logoUrlUploadFileReturnInput').val(data.data);
                                $('#logoUrlUploadFileReturnImg').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });

        $(document).delegate('#picturePosterUploadFile','change',function(){
            $.ajaxFileUpload
            (
                    {
                        url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'picturePosterUploadFile', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                                var tfsPath = '$utilWebconfig.getTfsRootPath()';
                                $('#picturePosterUploadFileReturnInput').val(data.data);
                                $('#picturePosterUploadFileReturnImg').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
        $('#btnSubmit').click(function(){
            $(this).prop('disabled',true);
            var actionUrl;
            var clubId = $('#clubForm').attr('clubId');
            if(clubId){
                actionUrl = '/clubManage/edit';
            }else{
                actionUrl = '/clubManage/add';
            }
            layer.alert(actionUrl);
            $('#clubForm').attr('action',actionUrl);
            $.post(actionUrl,$('#clubForm').serialize(),function(data){
                if(data.status == 200){
                    var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                    msg.show();
                    setTimeout(function(){
                        window.close();
                    },1050);
                }else{
                    var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                    msg.show();
                    $(this).prop('disabled',false);
                }
            });
        });
    });
</script>