<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/upload.js" type="text/javascript"></script>

<form name="addHotel" id="hotelForm" action="" method="post" hotelId="">
<div class="tab-content grogInfoWrap"  style="">
    <div class="tab-pane active" id="grogshopInfo">
        <div class="createHotrlTable">
            <table >
				<tr>
                    <td><span class="spColor">*</span>游记</td>
                    <td>
                    	<button type="button" class="btn btn-default addNeedKnow" id="gaikuang" onclick="addItemCall(this)">增加条目</button>
        	            <table class="table bigTables">
                            <tr>
                                <th>内容（500个字以内）</th>
                                <th>图片（最多6张）</th>
                                <th>拍摄于（30字以内）</th>
                                <th></th>
                            </tr>

                            <tr class="needKnow">
                                <td>
                                    <textarea name="detail" class="form-control extra-info-item-title" placeholder=""></textarea>
                                </td>
                                <td>
			                        <div class="fileImgWrap">
			                            <button type="button" class="btn btn-success">选择图片</button>
			                            <input type="file"  name="file" class="fileInp" id="FMUploadFile" accept="image/png,image/gif">
			                            <input type="hidden" name="coverURL" value=""  id="FMReturnInput">
			                            <p>注：图片大小不超过5M<br />建议尺寸：687*237</p>
			                        </div>
			                        <div class="propagandaView">
			                            <img src="" id="FMReturnInputImg"> #* #if($club.picturePoster) $utilWebconfig.getTfsRootPath()$!club.picturePoster  #end *#
			                        </div>
                                    <textarea name="travelImg" class="form-control extra-info-item-title" placeholder=""></textarea>
                                </td>
                                <td>
                                    <textarea class="form-control extra-info-item-text" name="travelDes" rows="3"></textarea>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-link" onclick="delneedKnowTR(this)">删除</button>
                                </td>
                            </tr>

                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <button type="button" class="btn btn-info" id="btnSubmit">保存</button>
</div>
</form>

<script>
	$(document).delegate("#FMUploadFile",'change',function(){
	     fileUpload('#FMUploadFile',2,pictureUploadCallBack);
	 })
		
 	var pictureUploadCallBack = function(data){
    if(data && data.status == 200){
		console.log(data.data);
        $('#FMReturnInput').val(data.data);
        $('#FMReturnInputImg').attr('src',tfsRootPath + data.data);
			
        }else{
            layer.msg('图片上传失败，请重试', {icon: 2});
        }
    }







//--------------------------------------------------------

    var addItemCall = function (obj) {
    
    	var conTr =$(obj).next().find(".needKnow");
    	console.log(conTr);
    	var i = conTr.length;
    	++i;
    	var itemId = $(obj).attr("id");
        var itemList = '<tr class="needKnow'+i+'"><td>'+
                '<input type="text" name="" class="form-control extra-info-item-title" placeholder=""></td>'+
                '<td><textarea name="" class="form-control extra-info-item-text" rows="3"></textarea></td>'+
				'<td><textarea name="" class="form-control extra-info-item-text" rows="3"></textarea></td>'+
                '<td><button type="button" class="btn btn-link" onclick="delneedKnowTR(this)">删除</button></td></tr>'
        $(obj).next().append(itemList);
       
    };

 	function delneedKnowTR(obj){
		$(obj).parent().parent().remove(); 
 	}
 	
 	//保存的
 	$('#btnSubmit').click(function(){
    	//if($("#hotelForm").valid()) {}
        $(this).prop('disabled', true);
        var count = $(".bigTables tr").length-1;
        alert("count ="+count )	;
        	
        	
        });
        
    	$("#cityId").focus( function(){
    	$.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/trip/selectRegion' ,{type:"3"} ,function(data){
	    	if(data.status == 200){
	    	var html="";
	    		$.each(data.data, function(n,val){ 
                   console.log("data:"+val.id+"  _"+val.name);
                   html+="<option level="+val.level+" cityCode="+val.cityCode+" provinceCode="+val.provinceCode+" value="+val.id+">"+val.name+"</option>"
                });
            $("#cityId").html(html);
	        }else{
	            var msg = new $.zui.Messager('获取城市列表失败', {placement: 'center',type:'warning',time:'1000'});
	            msg.show();
	            $(this).prop('disabled',false);
	        }                                      
    	})
    });
</script>