<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css" rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js" type="text/javascript"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/ckeditor/ckeditor.js" type="text/javascript"></script>
<script>
    //活动地点二级联动
    function Dsy() {
        this.Items = {};
    }
    Dsy.prototype.add = function(id, iArray) {
        this.Items[id] = iArray;
    }
    Dsy.prototype.Exists = function(id) {
        if (typeof (this.Items[id]) == "undefined") return false;
        return true;
    }

    function change(v) {
        var str = "0";
        for (i = 0; i < v; i++) { str += ("_" + (document.getElementById(s[i]).selectedIndex - 1)); };
        var ss = document.getElementById(s[v]);
        with (ss) {
            length = 0;
            options[0] = new Option(opt0[v], opt0[v]);
            if (v && document.getElementById(s[v - 1]).selectedIndex > 0 || !v) {
                if (dsy.Exists(str)) {
                    ar = dsy.Items[str];
                    for (i = 0; i < ar.length; i++) options[length] = new Option(ar[i], ar[i]);
                    if (v) options[1].selected = true;
                }
            }
            if (++v < s.length) { change(v); }
        }
    }

    var dsy = new Dsy();

    dsy.add("0", ["安徽", "北京", "福建", "甘肃", "广东", "广西", "贵州", "海南", "河北", "河南", "黑龙江", "湖北", "湖南", "吉林", "江苏", "江西", "辽宁", "内蒙古", "宁夏", "青海", "山东", "山西", "陕西", "上海", "四川", "天津", "西藏", " 新疆", "云南", "浙江", "重庆"]);
    dsy.add("0_0", ["安庆", "蚌埠", "巢湖", "池州", "滁州", "阜阳", "合肥", "淮北", "淮南", "黄山", "六安", "马鞍山", "宿州", "铜陵", "芜湖", "宣城", "亳州"]);
    dsy.add("0_1", ["北京市", "密云县", "延庆县"]);
    dsy.add("0_2", ["福州", "龙岩", "南平", "宁德", "莆田", "泉州", "三明", "厦门", "漳州"]);
    dsy.add("0_3", ["白银", "定西", "甘南藏族自治州", "嘉峪关", "金昌", "酒泉", "兰州", "临夏回族自治州", "陇南", "平凉", "庆阳", "天水", "武威", "张掖"]);
    dsy.add("0_4", ["潮州", "东莞", "佛山", "广州", "河源", "惠州", "江门", "揭阳", "茂名", "梅州", "清远", "汕头", "汕尾", "韶关", "深圳", "阳江", "云浮", "湛江", "肇庆", "中山", "珠海"]);
    dsy.add("0_5", ["百色", "北海", "崇左", "防城港", "桂林", "贵港", "河池", "贺州", "来宾", "柳州", "南宁", "钦州", "梧州", "玉林"]);
    dsy.add("0_6", ["安顺", "毕节", "贵阳", "六盘水", "黔东南苗族侗族自治州", "黔南布依族苗族自治州", "黔西南布依族苗族自治州", "铜仁", "遵义"]);
    dsy.add("0_7", ["白沙黎族自治县", "保亭黎族苗族自治县", "昌江黎族自治县", "澄迈县", "定安县", "东方", "海口", "乐东黎族自治县", "临高县", "陵水黎族自治县", "琼海", "琼中黎族苗族自治县", "三亚", "屯昌县", "万宁", "文昌", "五指山", "儋州"]);
    dsy.add("0_8", ["保定", "沧州", "承德", "邯郸", "衡水", "廊坊", "秦皇岛", "石家庄", "唐山", "邢台", "张家口"]);
    dsy.add("0_9", ["安阳", "鹤壁", "济源", "焦作", "开封", "洛阳", "南阳", "平顶山", "三门峡", "商丘", "新乡", "信阳", "许昌", "郑州", "周口", "驻马店", "漯河", "濮阳"]);
    dsy.add("0_10", ["大庆", "大兴安岭", "哈尔滨", "鹤岗", "黑河", "鸡西", "佳木斯", "牡丹江", "七台河", "齐齐哈尔", "双鸭山", "绥化", "伊春"]);
    dsy.add("0_11", ["鄂州", "恩施土家族苗族自治州", "黄冈", "黄石", "荆门", "荆州", "潜江", "神农架林区", "十堰", "随州", "天门", "武汉", "仙桃", "咸宁", "襄樊", "孝感", "宜昌"]);
    dsy.add("0_12", ["常德", "长沙", "郴州", "衡阳", "怀化", "娄底", "邵阳", "湘潭", "湘西土家族苗族自治州", "益阳", "永州", "岳阳", "张家界", "株洲"]);
    dsy.add("0_13", ["白城", "白山", "长春", "吉林", "辽源", "四平", "松原", "通化", "延边朝鲜族自治州"]);
    dsy.add("0_14", ["常州", "淮安", "连云港", "南京", "南通", "苏州", "宿迁", "泰州", "无锡", "徐州", "盐城", "扬州", "镇江"]);
    dsy.add("0_15", ["抚州", "赣州", "吉安", "景德镇", "九江", "南昌", "萍乡", "上饶", "新余", "宜春", "鹰潭"]);
    dsy.add("0_16", ["鞍山", "本溪", "朝阳", "大连", "丹东", "抚顺", "阜新", "葫芦岛", "锦州", "辽阳", "盘锦", "沈阳", "铁岭", "营口"]);
    dsy.add("0_17", ["阿拉善盟", "巴彦淖尔盟", "包头", "赤峰", "鄂尔多斯", "呼和浩特", "呼伦贝尔", "通辽", "乌海", "乌兰察布盟", "锡林郭勒盟", "兴安盟"]);
    dsy.add("0_18", ["固原", "石嘴山", "吴忠", "银川"]);
    dsy.add("0_19", ["果洛藏族自治州", "海北藏族自治州", "海东", "海南藏族自治州", "海西蒙古族藏族自治州", "黄南藏族自治州", "西宁", "玉树藏族自治州"]);
    dsy.add("0_20", ["滨州", "德州", "东营", "菏泽", "济南", "济宁", "莱芜", "聊城", "临沂", "青岛", "日照", "泰安", "威海", "潍坊", "烟台", "枣庄", "淄博"]);
    dsy.add("0_21", ["长治", "大同", "晋城", "晋中", "临汾", "吕梁", "朔州", "太原", "忻州", "阳泉", "运城"]);
    dsy.add("0_22", ["安康", "宝鸡", "汉中", "商洛", "铜川", "渭南", "西安", "咸阳", "延安", "榆林"]);
    dsy.add("0_23", ["崇明县", "上海市"]);
    dsy.add("0_24", ["阿坝藏族羌族自治州", "巴中", "成都", "达州", "德阳", "甘孜藏族自治州", "广安", "广元", "乐山", "凉山彝族自 治州", "眉山", "绵阳", "南充", "内江", "攀枝花", "遂宁", "雅安", "宜宾", "资阳", "自贡", "泸州"]);
    dsy.add("0_25", ["蓟县", "静海县", "宁河县", "天津市"]);
    dsy.add("0_26", ["阿里", "昌都", "拉萨", "林芝", "那曲", "日喀则", "山南"]);
    dsy.add("0_27", ["阿克苏", "阿拉尔", "巴音郭楞蒙古自治州", "博尔塔拉蒙古自治州", "昌吉回族自治州", "哈密", "和田", "喀什", "克 拉玛依", "克孜勒苏柯尔克孜自治州", "石河子", "图木舒克", "吐鲁番", "乌鲁木齐", "五家渠", "伊犁哈萨克自治州"]);
    dsy.add("0_28", [" 保山", "楚雄彝族自治州", "大理白族自治州", "德宏傣族景颇族自治州", "迪庆藏族自治州", "红河哈尼族彝族自治州", "昆明", "丽江", "临 沧", "怒江傈傈族自治州", "曲靖", "思茅", "文山壮族苗族自治州", "西双版纳傣族自治州", "玉溪", "昭通"]);
    dsy.add("0_29", ["杭州", "湖州", "嘉兴", "金华", "丽水", "宁波", "绍兴", "台州", "温州", "舟山", "衢州"]);
    dsy.add("0_30", ["重庆市", "沙坪坝","渝中","江北","南岸","九龙坡","大渡口","渝北","北碚","万盛","双桥","巴南","万州","涪陵","黔江","长寿","城口县", "大足县", "垫江县", "丰都县", "奉节县", "合川市", "江津市", "开县", "梁平县", "南川市", "彭 水苗族土家族自治县", "荣昌县", "石柱土家族自治县", "铜梁县", "巫山县", "巫溪县", "武隆县", "秀山土家族苗族自治县", "永川市", " 酉阳土家族苗族自治县", "云阳县", "忠县", "潼南县", "璧山县", "綦江县"]);

    var s = ["province", "city"];
    var opt0 = ["省份", "地级市"];
    function setup() {
        for (i = 0; i < s.length - 1; i++)
            document.getElementById(s[i]).onchange = new Function("change(" + (i + 1) + ")");
        change(0);
    }
    $(document).ready(function(){
        //价格列表删除按钮点击事件
        $(".deleteActive").on("click",function(){
            $(this).parent().parent().remove();
        });
        //活动地点二级联动
        setup();
    })
</script>
<div class="example whole">
    <form name="activityForm" id="activityForm" action="" method="post" activityId="$!activity.id">
        <ul id="myTab" class="nav nav-tabs">
            <li class="active">
                <a href="#tab1" data-toggle="tab">活动基础信息</a>
            </li>
            <li class="">
                <a href="#tab2" data-toggle="tab">价格</a>
            </li>
            <li class="">
                <a href="#tab3" data-toggle="tab">活动详情(APP)</a>
            </li>
            <li class="">
                <a href="#tab4" data-toggle="tab">活动详情(PC)</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab1">
                <div class="createClubTable">
                    <table class="table">
                        <tbody>
                        <tr>
                            <td><span class="spColor">*</span>活动名称</td>
                            <td>
                                <input type="hidden" class="form-control" name="id" value="$!activity.id">
                                <input type="text" class="form-control" placeholder="请输入20个字以内" name="title" value="$!activity.title">
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>活动宣传图</td>
                            <td>
                                <div class="fileImg activeFile">
                                    <button type="button" class="btn btn-success">选择图片</button>
                                    <input type="hidden" name="image" value="$!activity.image" id="imageUploadFileReturnInput" >
                                    <input type="file" name="file" class="fileInp" id="imageUploadFile">
                                    <p>注：1至3张，每张图片<br/>大小不超过5M<br />第一张为列表页显示图<br/>建议尺寸：750*351</p>
                                </div>
                                <div class="activeImg">
                                    <img src="#if($!activity.image) $utilWebconfig.getTfsRootPath()$!activity.image #end" alt="活动宣传图" id="imageUploadFileReturnImg">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>所属俱乐部</td>
                            <td>
                                <select class="form-control" name="outId">
                                    <option value="0">请选择</option>
                                    <option value="$!activity.outId" #if($!activity.outId == 1) checked #end>无</option>
                                    <option value="$!activity.outId" #if($!activity.outId == 2) checked #end>亲子俱乐部</option>
                                    <option value="$!activity.outId" #if($!activity.outId == 3) checked #end>骑行俱乐部</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>分类</td>
                            <td>亲子<input type="hidden" class="form-control" name="outType" value="$!activity.outType"></td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>排序</td>
                            <td><input type="text" class="form-control" placeholder="请输入数字，数字越大排序靠后" name="sequenceNum" value="$!activity.sequenceNum"></td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>状态</td>
                            <td>
                                <div class="col-md-10">
                                    <label class="radio-inline"> <input type="radio" name="status" value="1" #if($!activity.status == 1) checked #end> 上架 </label>
                                    <label class="radio-inline"> <input type="radio" name="status" value="2" #if($!activity.status == 2) checked #end> 下架 </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>活动日期</td>
                            <td>
                                <div class="row">
                                    <div class="col-md-4"><input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="startDate" value="$!utilDate.dateToString($!activity.startDate,"yyyy-MM-dd HH:mm:ss")"></div>
                                    <span class="input-group-addon fix-border fix-padding">至</span>
                                    <div class="col-md-4"><input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="endDate" value="$!utilDate.dateToString($!activity.endDate,"yyyy-MM-dd HH:mm:ss")"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>报名时间</td>
                            <td>
                                <div class="row">
                                    <div class="col-md-4"><input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="enrollBeginDate" value="$!utilDate.dateToString($!activity.enrollBeginDate,"yyyy-MM-dd HH:mm:ss")"></div>
                                    <span class="input-group-addon fix-border fix-padding">至</span>
                                    <div class="col-md-4"><input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="enrollEndDate" value="$!utilDate.dateToString($!activity.enrollEndDate,"yyyy-MM-dd HH:mm:ss")"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>活动地点</td>
                            <td>
                                <select class="form-control selCity" name="province" id="province" value="$!activity.province">
                                    #if($!activity.provinceId)
                                        <option>$!activity.provinceName</option>
                                    #else
                                        <option>请选择省份</option>
                                    #end

                                </select>
                                <select class="form-control selCity" name="city" id="city" value="$!activity.city">
                                    #if($!activity.cityId)
                                        <option>$!activity.cityName</option>
                                    #else
                                        <option>请选择城市</option>
                                    #end
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="spColor">*</span>详细地址</td>
                            <td><input type="text" class="form-control" placeholder="请输入30字以内" name="addrDetail" value="$!activity.addrDetail"></td>
                        </tr>
                        <tr>
                            <td>活动概要</td>
                            <td><input type="text" class="form-control" placeholder="请输入15字以内" name="outline" value="$!activity.outline"></td>
                        </tr>
                        <tr>
                            <td>活动标签</td>
                            <td>
                                <div class="input-group">
                                    #foreach($tag in $activity.tagList)
                                        <input type="text" class="form-control" placeholder="" name="tagList" value="$!tag">
                                        <span class="input-group-addon fix-border fix-padding"></span>
                                    #end
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>费用说明</td>
                            <td><textarea id="summaryMoney" rows="3" class="form-control" placeholder="请输入300字以内" name="costExplain">$!activity.costExplain</textarea></td>
                        </tr>
                        <tr>
                            <td>温馨提示</td>
                            <td><textarea  id="summaryNote" rows="3" class="form-control" placeholder="请输入300字以内" name="reminder">$!activity.reminder</textarea></td>
                        </tr>
                        <tr>
                            <td>购买流程</td>
                            <td><textarea  id="summaryPay" rows="3" class="form-control" placeholder="请输入300字以内" name="buyProcess">$!activity.buyProcess</textarea></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane activeMnyPane" id="tab2">
                <p class="pNote">提示：活动单规格或多规格二选一</p>
                <div class="col-md-10">
                    <label class="radio-inline radioActive">
                        <input type="radio" name="optionsRadios" value="option1" checked=""> 活动单规格：
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <td>库存</td>
                                <td>原价</td>
                                <td>优惠价</td>
                                <td>操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td><input type="text" name="" /></td>
                                <td><input type="text" name="" /></td>
                                <td><input type="text" name="" /></td>
                                <td><a href="#" class="deleteActive">删除</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </label>
                    <label class="radio-inline radioActive">
                        <input type="radio" name="optionsRadios" value="option2">活动多规格：亲子活动
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name="" class="checkboxLeft"/>亲子
                        </label>
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name=""/>儿童
                        </label>
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name=""/>家庭
                        </label>
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <td>类型</td>
                                <td>排序</td>
                                <td>库存</td>
                                <td>原价</td>
                                <td>优惠价</td>
                                <td>操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>亲子</td>
                                <td>0</td>
                                <td>5</td>
                                <td>99</td>
                                <td>90</td>
                                <td><a href="#" class="deleteActive">删除</a></td>
                            </tr>
                            <tr>
                                <td>亲子</td>
                                <td>0</td>
                                <td>5</td>
                                <td>99</td>
                                <td>90</td>
                                <td><a href="#" class="deleteActive">删除</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </label>
                    <label class="radio-inline radioActive">
                        <input type="radio" name="optionsRadios" value="option2">活动多规格(共享库存)：亲子活动
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name="" class="checkboxLeft"/>亲子
                        </label>
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name=""/>儿童
                        </label>
                        <label for="" class="checkActiveType">
                            <input type="checkbox" name=""/>家庭
                        </label>

                        <span class="totalSp">总库存：</span>
                        <input type="text" name="" id=""/>
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <td>类型</td>
                                <td>排序</td>
                                <td>库存</td>
                                <td>原价</td>
                                <td>优惠价</td>
                                <td>操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>亲子</td>
                                <td>0</td>
                                <td>5</td>
                                <td>99</td>
                                <td>90</td>
                                <td><a href="#" class="deleteActive">删除</a></td>
                            </tr>
                            <tr>
                                <td>亲子</td>
                                <td>0</td>
                                <td>5</td>
                                <td>99</td>
                                <td>90</td>
                                <td><a href="#" class="deleteActive">删除</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </label>
                </div>
            </div>
            <div class="tab-pane" id="tab3">
                <textarea id="activityDetailWeb" name="activityDetailWeb" cols="20" rows="60" class="ckeditor"  >
                    $!activity.activityDetailWeb
                </textarea>
            </div>
            <div class="tab-pane" id="tab4">
                <textarea id="activityDetailWeb" name="activityDetailApp" cols="20" rows="60" class="ckeditor"  >
                    $!activity.activityDetailApp
                </textarea>
            </div>
            <div class="clubBotBtn">
                <div class="btn-group">
                    <button class="btn btn-success" type="button" id="btnSubmit" >添加</button>
                </div>
                <div class="btn-group">
                    <button class="btn">取消</button>
                </div>
            </div>
        </div>
    </form>
</div>
#*<object style="border:0px" type="text/x-scriptlet" data="http://192.168.1.209:7500/v1/tfs/T1IRhTByZT1RX1qZUK" width=100% height=30></object>*#

<script>


    $(".form-date").datetimepicker(
            {
                language:  "zh-CN",
                weekStart: 1,
                todayBtn:  1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                forceParse: 0,
                showMeridian: 1,
                format: "yyyy-mm-dd hh:ii"
            });
    $(function(){
        $(document).delegate('#imageUploadFile','change',function(){
            $.ajaxFileUpload
            (
                    {
                        url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'imageUploadFile', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                                var tfsPath = '$utilWebconfig.getTfsRootPath()';
                                $('#imageUploadFileReturnInput').val(data.data);
                                $('#imageUploadFileReturnImg').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
        $('#btnSubmit').click(function(){
            $(this).prop('disabled',true);
            var actionUrl;
            var activityId = $('#activityForm').attr('activityId');
            if(activityId){
                actionUrl = '$!utilWebconfig.getActionDefaultFontPath()/B2C/activityManage/edit';
            }else{
                actionUrl = '$!utilWebconfig.getActionDefaultFontPath()/B2C/activityManage/add';
            }
            layer.alert(actionUrl);
            $('#activityForm').attr('action',actionUrl);
            $('#activityForm').submit();
        });
    });
</script>