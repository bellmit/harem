<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css" rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js" type="text/javascript"></script>
<h1>活动列表</h1>
    <form class="form-signin" id="activityListForm" name="activityListForm" action="$!utilWebconfig.getActionDefaultFontPath()/B2C/activityManage/list" method="GET" role="form">
        <div class="inputGroup whole">
            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">创建时间</button>
                    </span>
                <input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="beginDate" value="$!activityListQuery.beginDate">
                <span class="input-group-addon fix-border fix-padding">至</span>
                <input type="text" class='form-control form-date' placeholder='结束日期：yyyy-MM-dd' readonly name="endDate" value="$!activityListQuery.endDate">
            </div>
            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">活动时间</button>
                    </span>
                <input type="text" class='form-control form-date' placeholder='开始日期：yyyy-MM-dd' readonly name="activityBeginDate" value="$!activityListQuery.activityBeginDate">
                <span class="input-group-addon fix-border fix-padding">至</span>
                <input type="text" class='form-control form-date' placeholder='结束日期：yyyy-MM-dd' readonly name="activityEndDate" value="$!activityListQuery.activityEndDate">
            </div>
            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">活动名称</button>
                    </span>
                <input type="text" class="form-control" name="name" value="$!activityListQuery.name">
            </div>

            <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">状态：</button>
                </span>
                <select class="form-control" name="isStatus">
                    <option value="0">全部</option>
                    <option value="1" #if($!activityListQuery.isStatus == 1) selected #end>上架</option>
                    <option value="2" #if($!activityListQuery.isStatus == 2) selected #end>下架</option>
                    <option value="3" #if($!activityListQuery.isStatus == 3) selected #end>满员</option>
                    <option value="4" #if($!activityListQuery.isStatus == 4) selected #end>已结束</option>
                </select>
            </div>
            <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">俱乐部：</button>
                </span>
                <select class="form-control" name="club">
                    <option value="0">全部</option>
                    <option value="1" #if($!activityListQuery.club == 1) selected #end>亲自俱乐部</option>
                </select>
            </div>
            <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">前台显示：</button>
                </span>
                    <select class="form-control" name="isStatus">
                        <option value="1" #if($!activityListQuery.isStatus == 1) selected #end>显示</option>
                        <option value="2" #if($!activityListQuery.isStatus == 2) selected #end>隐藏</option>
                    </select>
            </div>
            <div class="btn-group">
                <button type="submit" class="btn btn-primary">查询</button>
            </div>
            <div class="btn-group">
                <button type="reset" class="btn btn-primary">重置</button>
            </div>
        </div>

        <div class="tableGroup whole">
            <button type="button" class="btn btn-primary activityAdd">新建</button>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>活动名称</th>
                    <th>所属俱乐部</th>
                    <th>活动时间</th>
                    <th>报名时间</th>
                    <th>状态</th>
                    <th>报名数量</th>
                    <th>报名限额</th>
                    <th>价格</th>
                    <th>访问量</th>
                    <th>创建时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                    #foreach($activity in $activityList)
                    <tr>
                        <td>$!velocityCount</td>
                        <td>$!activity.title</td>
                        <td>$!activity.clubName</td>
                        <td>$utilDate.dateToString($!activity.startDate,"yyyy-MM-dd HH:mm")至$utilDate.dateToString($!activity.endDate,"yyyy-MM-dd HH:mm")</td>
                        <td>$utilDate.dateToString($!activity.enrollBeginDate,"yyyy-MM-dd HH:mm")至$utilDate.dateToString($!activity.enrollEndDate,"yyyy-MM-dd HH:mm")</td>
                        <td>#ACTIVITY_STATUS($!activity.status)</td>
                        <td>$!activity.memberCount</td>
                        <td>$!activity.memberCountLimit</td>
                        <td>$!activity.originalPrice</td>
                        <td>88</td>
                        <td>$utilDate.dateToString($!activity.createrTime,"yyyy-MM-dd HH:mm")</td>
                        <td>
                        <button type="button" class="btn btn-primary activityDetail" activityId="$activity.id">查看</button>
                        <button type="button" class="btn btn-primary activityBtn"  activityId="$activity.id" isStatus="$activity.isStatus">#if($activity.isStatus == 1) 下架 #elseif($activity.isStatus == 2) 上架 #end </button>
                        </td>
                    </tr>
                    #end
                </tbody>
            </table>
        </div>
    #*分页*#
    #parse("/page.vm")
    #pageStyle("activityListForm")
    </form>
<script>
    $(".form-date").datetimepicker(
            {
                language:  "zh-CN",
                weekStart: 1,
                todayBtn:  1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                minView: 2,
                forceParse: 0,
                format: "yyyy-mm-dd"
            });
    $(function(){
        $('.activityAdd').click(function(){
            var url = '$!utilWebconfig.getActionDefaultFontPath()' + '/B2C/activityManage/toAdd';
            window.openwin(url);
        });

        $('.activityDetail').each(function(){
            $(this).click(function(){
                var url = '$!utilWebconfig.getActionDefaultFontPath()' + '/B2C/activityManage/'+ $(this).attr('activityId');
                window.openwin(url);
            });

        });

        $('.activityBtn').each(function(){
            $(this).click(function(){
                $(this).prop('disabled',true);
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/activityManage/setIsStatus/' + $(this).attr('activityId') ,{'isStatus':$(this).attr('isStatus')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                        //TODO暂时先刷新页面
                        setTimeout(function(){
                            window.location.href = window.location.href;
                        },1050);
                        //window.location.href = window.location.href;
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                        $(this).prop('disabled',false);
                    }
                })
            });
        });
    });
</script>