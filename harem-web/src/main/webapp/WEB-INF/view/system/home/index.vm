<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<div class="example whole">
    
        <ul id="myTab" class="nav nav-tabs">
            <li class="active">
                <a href="#tab1" data-toggle="tab">会员专享</a>
            </li>
            <li class="">
                <a href="#tab2" data-toggle="tab">大咖带你玩</a>
            </li>
            <li class="">
                <a href="#tab3" data-toggle="tab">金牌旅游咖</a>
            </li>
            <li class="">
                <a href="#tab4" data-toggle="tab">目的地</a>
            </li>
            <li class="">
                <a href="#tab5" data-toggle="tab">品牌游记</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="tab1">
            <form id="userForm" action="" method="post">
                <div class="createClubTable">
                    <table class="table">
                        <tbody>
                        <tr>
                            <td><span class="spColor">*</span>副标题</td>
                            <td>
                                <input type="text" class="form-control" placeholder="请输入20个字以内" name="subTitle" value=""> <button type="button" class="btn btn-success selectUserBtn">选择商品</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <table class="table userTable">
                    	<thead>
                    	<tr>
                            <td>图片</td>
                            <td>名称</td>
                            <td>描述</td>
                            <td>操作</td>
                        </tr>
                    	</thead>
                    	<tbody>
                    	</tbody>
                    </table>
                </div>
                 <div class="clubBotBtn">
                <div class="btn-group">
                    <button class="btn btn-success" type="button" id="vipSubmit" >添加</button>
                </div>
                <div class="btn-group">
                    <button class="btn">取消</button>
                </div>
            </div>
            </form>
            </div>
            <div class="tab-pane activeMnyPane" id="tab2">
                 <form id="lineForm" action="" method="post">
                    <div class="createClubTable">
                        <table class="table">
                            <tbody>
                            <tr>
                                <td><span class="spColor">*</span>副标题</td>
                                <td>
                                    <input type="text" class="form-control" placeholder="请输入20个字以内" name="subTitle" value=""> <button type="button" class="btn btn-success selectLineBtn">选择商品</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table lineTable">
                        	<thead>
                        		<tr>
                                <td>头像</td>
                                <td>名称</td>
                                <td>用户</td>
                                <td>操作</td>
                            </tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </div>
                     <div class="clubBotBtn">
                    <div class="btn-group">
                        <button class="btn btn-success"  type="button"  id="lineSubmit" >添加</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn">取消</button>
                    </div>
                </div>
                </form>
            </div>
            <div class="tab-pane" id="tab3">
            <form id="travelKaForm" action="" method="post">
                    <div class="createClubTable">
                        <table class="table">
                            <tbody>
                            <tr>
                                <td><span class="spColor">*</span>副标题</td>
                                <td>
                                    <input type="text" class="form-control" placeholder="请输入20个字以内" name="subTitle" value=""> <button type="button" class="btn btn-success selectTravelKaBtn">选择商品</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table travelKaTable">
                        	<thead>
                        		<tr>
                                <td>头像</td>
                                <td>昵称</td>
                                <td>操作</td>
                            </tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </div>
                     <div class="clubBotBtn">
                    <div class="btn-group">
                        <button class="btn btn-success"  type="button"  id="travelKaSubmit" >添加</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn">取消</button>
                    </div>
                </div>
                </form>
            </div>
            <div class="tab-pane" id="tab4">
           <form id="cityForm" action="" method="post">
                    <div class="createClubTable">
                        <table class="table">
                            <tbody>
                            <tr>
                                <td><span class="spColor">*</span>副标题</td>
                                <td>
                                    <input type="text" class="form-control" placeholder="请输入20个字以内" name="subTitle" value=""> <button type="button" class="btn btn-success selectCityBtn">选择商品</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table cityTable">
                        	<thead>
                        		<tr>
                                <td>图片</td>
                                <td>目的地</td>
                                <td>操作</td>
                            </tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </div>
                     <div class="clubBotBtn">
                    <div class="btn-group">
                        <button class="btn btn-success"  type="button"  id="citySubmit" >添加</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn">取消</button>
                    </div>
                </div>
                </form>
            </div>
            <div class="tab-pane" id="tab5">
            <div class="createClubTable">
                        <table class="table">
                            <tbody>
                            <tr>
                                <td><span class="spColor">*</span>副标题</td>
                                <td>
                                    <input type="text" class="form-control" placeholder="请输入20个字以内" name="subTitle" value=""> <button type="button" class="btn btn-success selectCityBtn">选择商品</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <table class="table cityTable">
                        	<thead>
                        		<tr>
                                <td>图片</td>
                                <td>目的地</td>
                                <td>操作</td>
                            </tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </div>
                     <div class="clubBotBtn">
                    <div class="btn-group">
                        <button class="btn btn-success"  type="button"  id="citySubmit" >添加</button>
                    </div>
                    <div class="btn-group">
                        <button class="btn">取消</button>
                    </div>
                </div>
                </form>
            </div>
        </div>
</div>
#*<object style="border:0px" type="text/x-scriptlet" data="http://192.168.1.209:7500/v1/tfs/T1IRhTByZT1RX1qZUK" width=100% height=30></object>*#

<script>

    $(function(){
    
	    $(document).on("click",".delUser a",function(){
			 $(this).parents("tr:eq(0)").remove();
		}); 
    	
        
         //选择用户信息
        $('.selectUserBtn').click(function(){
            layer.open({
                type: 2,
                btn: ['确定', '取消'],
                title: '用户选择',
                fix: false,
                shadeClose: true,
                maxmin: true,
                area: ['1000px', '500px'],
                content: '$!utilWebconfig.getActionDefaultFontPath()/trade/userManage/selectUserList',
                yes: function(index){
                    layer.alert(top.resultValue.length)
                    if(top.resultValue&&top.resultValue.length==0){
                        layer.alert("请选择用户信息");
                        return false;
                    }else{
                    console.log(resultValue);
                    	var tbody = $(".userTable tbody");
						var tr = "";
                    	for(var i = 0;i<resultValue.length;i++){
                    		tr += "<tr ><td><input type='hidden' name='itemIds' value='"+resultValue[i].id+"'> <img id='imgUploadUrlVip"+resultValue[i].id+"' src='http://192.168.1.209:7500/v1/tfs/T1QyJTByKT1RCvBVdK' width=100px height=80px alt='头像' >"+ 
                    		"<input type='file' name='file' class='fileInp' id='imageUploadFileVip"+resultValue[i].id+"'><input type='hidden' id='imgUrlVip"+resultValue[i].id+"' name='imgUrl' value='http://192.168.1.209:7500/v1/tfs/T1QyJTByKT1RCvBVdK'></td>"+
                    		"<td><input type='text' name='itemTitle' readonly value='"+resultValue[i].name+"'></td>"+
                    		"<td><input type='text' name='description' value=''></td><td class='delUser'><a>删除</a></td></tr>";
                    		_uploadImg("Vip"+resultValue[i].id);
                    	}
                    	$(".userTable").find("tbody").append(tr);
                    	
                    	 layer.close(index);
                    }
                }
            });
			
         //选择线路信息
        $('.selectLineBtn').click(function(){
            layer.open({
                type: 2,
                btn: ['确定', '取消'],
                title: '用户选择',
                fix: false,
                shadeClose: true,
                maxmin: true,
                area: ['1000px', '500px'],
                content: '$!utilWebconfig.getActionDefaultFontPath()/trade/userManage/selectUserList',
                yes: function(index){
                    layer.alert(top.resultValue.length)
                    if(top.resultValue&&top.resultValue.length==0){
                        layer.alert("请选择用户信息");
                        return false;
                    }else{
                    console.log(resultValue);
                    	var tbody = $(".userTable tbody");
						var tr = "";
                    	for(var i = 0;i<resultValue.length;i++){
                    		tr += "<tr ><td><input type='hidden' name='itemIds' value='"+resultValue[i].id+"'> <img id='imgUploadUrlVip"+resultValue[i].id+"' src='http://192.168.1.209:7500/v1/tfs/T1QyJTByKT1RCvBVdK' width=100px height=80px alt='头像' >"+ 
                    		"<input type='file' name='file' class='fileInp' id='imageUploadFileVip"+resultValue[i].id+"'><input type='hidden' id='imgUrlVip"+resultValue[i].id+"' name='imgUrl' value='http://192.168.1.209:7500/v1/tfs/T1QyJTByKT1RCvBVdK'></td>"+
                    		"<td><input type='text' name='itemTitle' readonly value='"+resultValue[i].name+"'></td>"+
                    		"<td><input type='text' name='description' value=''></td><td class='delUser'><a>删除</a></td></tr>";
                    		_uploadImg("Vip"+resultValue[i].id);
                    	}
                    	$(".userTable").find("tbody").append(tr);
                    	
                    	 layer.close(index);
                    }
                }
            });
            })
            
            
      
        
        $('#vipSubmit').click(function(){
            $(this).prop('disabled',true);
            $.ajax({
				type:'post',
				url:'addHomeVip',
				data:$("#userForm").serialize(),
				error:function(){
					$("#vipSubmit").attr("disabled",false);
					alert('服务器忙，请稍后再试！');
				},
				success:function(data){
				
					if(data.status==200){
						 layer.alert('操作成功');
						 $("#vipSubmit").attr("disabled",false);
                    }else{
                   		$("#vipSubmit").attr("disabled",false);
                        layer.alert('操作失败');
                    }
				}
			});
        });
    });
    
    
  function _uploadImg(id){
	 $(document).delegate('#imageUploadFile'+id,'change',function(){
            $.ajaxFileUpload
            (
                    {
                        url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'imageUploadFile'+id, //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                                var tfsPath = '$utilWebconfig.getTfsRootPath()';
                                $('#imgUrl'+id).val(tfsPath + data.data);
                                $('#imgUploadUrl'+id).attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
}
</script>