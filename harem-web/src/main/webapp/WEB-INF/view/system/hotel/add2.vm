<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/layerModal.js" type="text/javascript"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/map.js" type="text/javascript"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.all.min.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/lang/zh-cn/zh-cn.js"></script>
<style type="text/css">
    .demo {
        width: 850px;
        margin: 20px auto;
        display: none;
    }

    #l-map {
        height: 400px;
        width: 600px;
        float: left;
        border: 1px solid #bcbcbc;
    }

    #r-result {
        height: 400px;
        width: 230px;
        float: right;
    }
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<ul id="myTab" class="nav nav-tabs">
    <li class="active">
        <a href="#grogshopInfo" data-toggle="tab">酒店信息</a>
    </li>
    <li>
        <a href="#grogshopImgs" data-toggle="tab">图片集</a>
    </li>
</ul>
<form name="addHotel" id="hotelForm" action="" method="post" hotelId="$!hotel.id">
<div class="tab-content grogInfoWrap"  style="">
    <div class="tab-pane active" id="grogshopInfo">
        <div class="createHotrlTable">
            <table class="table">
				<tbody>
               <tr>
                    <td><span class="spColor">*</span>酒店名称</td>
					#if($!{hotel.id})
						<input type="hidden" name="id" value="$!{hotel.id}">
					#end
                    <td><input type="text" class="inpControl" name="name" placeholder="请输入20个字以内" value="$!{hotel.name}"></td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>选择地址</td>
                    <td>
                        <div class="selectList">
                            <input type="hidden" id="provinceSelectName" name="locationProvinceName" value="$!hotel.locationProvinceName">
                            <select id="provinceId" class="selCity inpControl provinceSelect" name="locationProvinceId" areaType="PROVINCE">
                                <option selected value="$!hotel.locationProinceId">$!hotel.locationProvinceName</option>
                            </select>
                            <input type="hidden" id="citySelectName" name="locationCityName" value="$!hotel.locationCityName">
                            <select id="cityId" class="selCity inpControl citySelect" name="locationCityId" areaType="CITY">
								<option selected value="$!hotel.locationCityId">$!hotel.locationCityName</option>
                            </select>
							<input type="hidden" id="countySelectName" name="locationTownName" value="$!hotel.locationTownName">
                            <select id="countyId" class="selCity inpControl countySelect" name="locationTownId" areaType="COUNTY">
                                <option selected value="$!hotel.locationTownId">$!hotel.locationTownName</option>
                            </select>			
                            <input type="text" class="inpControl" name="locationText" id="locationText" placeholder="请输入街道门牌号" value="$!hotel.locationText">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>星级</td>
                    <td>
                        <select class="form-control" name="level">
                            <option value="4" #if($!hotel.level == 4) selected #end>2星及以下 经济型</option>
                            <option value="3" #if($!hotel.level == 3) selected #end>3星 舒适型</option>
                            <option value="2" #if($!hotel.level == 2) selected #end>4星 高档型</option>
                            <option value="1" #if($!hotel.level == 1) selected #end>5星 豪华型</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>地址经纬度</td>
                    <td><span>经度</span><input type="text" id="locationX" name="locationX" class="inpControl getAddress"><span>纬度</span><input type="text" id="locationY" name="locationY" class="inpControl getAddress"><button type="button" class="btn btn-primary locationXYSelectBtn">查找经纬度</button></td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>酒店电话</td>
                    <td>
                        <input type="text" class="inpControl" name="phoneNumList" id="phoneNum" value="$!hotel.phoneNum" placeholder="请输入酒店电话">
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>酒店简介</td>
                    <td>
                        <textarea name="oneword" id="grogDescr" rows="3" class="form-control" placeholder="请输入80字以内">$!hotel.oneword</textarea>
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>特色描述</td>
                    <td>
                        <textarea name="description" rows="3" class="form-control" placeholder="请输入500字以内">$!hotel.description</textarea>
                    </td>

                </tr>
                <tr>
                    <td><span class="spColor">*</span>基础价格<br/>(单位：元)</td>
                    <td><input type="text" name="price" value="$!hotel.price" class="inpControl" >起</td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>酒店联系人</td>
                    <td><span>姓名：</span><input type="text" name="grogLinkmanName" value="$!hotel.contactPerson" class="inpControl" >
                        <span>电话：</span><input type="text" name="grogLinkmanPhone" value="$!hotel.contactPhone" class="inpControl" >
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>房间设施</td>
					<input id="roomFacilityStrId" type="hidden" name="roomFacilityStr" />
                    <td class="grogCheckSel">
						#set($indexNo = 0)
                        #foreach($!roomFacility in $!roomFacilityList)
							#set($indexNo = $indexNo + 1)
							#set($indexNoId = "roomFacility" + $indexNo)
							#if($!roomFacility.number == 1)
								<span>房间设施</span><br/>
							#end
							#if($!roomFacility.number == 34)
								<br/><span>浴室</span><br/>
							#end
							#if($!roomFacility.number == 44)
								<br/><span>室外景观</span><br/>
							#end
							#if($!roomFacility.number == 55)
								<br/><span>其他服务</span><br/>
							#end
                            <span><input type="checkbox" id="$!indexNoId" class="facilityCl" #if($!roomFacility.checked) checked value="1" #else value="0" #end>$roomFacility.name</span>
							#if($!roomFacility.number % 10 == 0 
								|| $!roomFacility.number == 33
								|| $!roomFacility.number == 43
								|| $!roomFacility.number == 54) 
								<br/>
							#end
						#end
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>特色服务</td>
					<input id="roomServiceStrId" type="hidden" name="roomServiceStr"/>
                    <td  class="grogCheckSel">
						#set($indexNo = 0)
                        #foreach($!roomService in $!roomServiceList)
							#set($indexNo = $indexNo + 1)
							#set($indexNoId = "roomService" + $indexNo)
                            <span><input type="checkbox" id="$!indexNoId" class="facilityCl" #if($!roomService.checked) checked value="1" #else value="0" #end>$roomService.name</span>
							#if($!roomService.number % 10 == 0)
								<br/>
							#end
						#end
                    </td>
                </tr>
                <tr>
                    <td><span class="spColor">*</span>酒店设施</td>
					<input id="hotelFacilityStrId" type="hidden" name="hotelFacilityStr"/>
                    <td  class="grogCheckSel">
						#set($indexNo = 0)
                        #foreach($!hotelFacility in $!hotelFacilityList)
							#set($indexNo = $indexNo + 1)
							#set($indexNoId = "hotelFacility" + $indexNo)
                            <span><input type="checkbox" id="$!indexNoId" class="facilityCl" #if($!hotelFacility.checked) checked value="1" #else value="0" #end>$hotelFacility.name</span>
							#if($!hotelFacility.number % 10 == 0)
								<br/>
							#end
						#end
                    </td>
                </tr>
                <tr>$!hotel.openTimelist
                    <td><span class="spColor">*</span>最晚到店时间</td>
                    <td>
                        #set($timeArr=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])
                        #set($numArr=[0,1,2])
                        #foreach($index in $numArr)
                            <select class="selCity inpControl" name="openTimeList">
                                <option value="">请选择</option>
                                #foreach($item in $timeArr)
                                    <option value="$item" #if($item == $!hotel.openTimeList.get($index)) selected #end>$item</option>
                                #end
                            </select>
                        #end
                    </td>
                </tr>
                    <tr>
                        <td>推荐理由</td>
                        <td>
                            <button type="button" class="btn btn-info selectUser">选择旅游咖</button>
                      		  <input type="text" name="title"  class="inpControl"
                                   value="#if(! $recommend.title)大咖推荐#else$!recommend.title#end">
                            <img src="#if($recommend.userPic) $utilWebconfig.getTfsRootPath()$!recommend.userPic  #end"
                                 alt="头像" class="img-circle grogUserLogo" id="userImg">
                                 <span id="recommendNameT"></span>
                            <textarea name="description" id="recommend" rows="3" class="form-control"
                                      placeholder="请输入300字以内">$!{recommend.description}</textarea>
                            <input type="hidden" id="recommendId" name="id" value="$!{recommend.id}" >
                            <input type="hidden" id="recommendUserId" name="userId" value="$!{recommend.userId}" >
                            <input type="hidden" id="recommendUserPic" name="userPic" value="$!{recommend.userPic}" >
                            <input type="hidden" id="recommendName" name="name" value="$!{recommend.name}" >
                        </td>
                    </tr>
                     <tr>
                        <td><span class="spColor">*</span>列表页展示图</td>
                        <td>
                            <div class="fileImg">
	                        <button type="button" class="btn btn-success">选择图片</button>
	                        <input type="hidden" name="scenic.logoUrl" value="$!{VO.scenic.logoUrl}" id="logoUrlUploadFileReturnInput" >
	                        <input type="file" name="file" class="fileInp" id="logoUrlUploadFile">
	                        <p>注：图片大小不超过5M<br />建议尺寸：300*300</p>
	                    </div>
	                    <div class="logoView">
	                        <img src="#if($VO.scenic.logoUrl) $utilWebconfig.getTfsRootPath()$!{VO.scenic.coverUrl} #end" class="img-square" id="logoUrlUploadFileReturnImg">
	                    </div>
                        </td>
                    </tr>                                        
                     <tr>
                        <td><span class="spColor">*</span>详情页展示图</td>
                        <td>
                            <div class="fileImg">
	                        <button type="button" class="btn btn-success">选择图片</button>
	                        <input type="hidden" name="scenic.coverUrl" value="$!{VO.scenic.coverUrl}" id="logoUrlUploadFileReturnInput1" >
	                        <input type="file" name="file" class="fileInp" id="logoUrlUploadFile1">
	                        <p>注：图片大小不超过5M<br />建议尺寸：300*300</p>
	                    </div>
	                    <div class="logoView">
	                        <img src="#if($VO.scenic.coverUrl) $utilWebconfig.getTfsRootPath()$!{VO.scenic.coverUrl} #end" class="img-square" id="logoUrlUploadFileReturnImg1">
	                    </div>
                        </td>
                    </tr>
				
				</tbody>
            </table>
        </div>
    </div>
    <button type="button" class="btn btn-info" id="btnSubmit">保存</button>
    <div class="tab-pane" id="grogshopImgs">
        #parse("/system/hotel/picture.vm")
    </div>
</div>
</form>
<script>
    //表单验
	var provinceFlag = false;
	var cityFlag = false;
	var areaFlag = false;
    
	var mapCallback = function (data) {
        if (data) {
            $("#locationX").val(data['pointX']);
            $("#locationY").val(data['pointY']);
        }
    }

	var tfsPath = '$utilWebconfig.getTfsRootPath()';
	
    $(function(){
	
       $('.selectUser').click(function(){
         	openModalForForm(actionDefaultPath + '/B2C/resourceForSelect/selectOneTravelKa','选择大咖',function() {
				var ka = win.getTravelKa();
				if(ka == null) return;
				$("#recommendName").val(ka.nickName);
				$("#userImg").attr('src',tfsPath + ka.avatar);
				$("#recommendId").val(ka.id);
				$("#recommendUserId").val(ka.userId);
				$("#recommendUserPic").val(ka.avatar);
				$("#recommendNameT").html(ka.nickName);
				return true;
			});
        })
	
		var localProvinceName = '$!hotel.locationProvinceName'+'';
		$.ajaxSetup({
			async : false
		});
		
		$('.locationXYSelectBtn').click(function () {
			//alert("HelloWorld!!!!!!!!!");
            openBaiduMap(115.727899, 37.723961, mapCallback);
        });

		
		$(".facilityCl").click(function() {
			if($(this).prop('checked')) {
				$(this).val("1");
			} else {
				$(this).val("0");
			}
		});
		
		$('.provinceSelect').click(function() {
			
			if (provinceFlag) {
				return;
			}
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': $(this).attr("areaType"),
					 'areaParentCode': null}, 
					function(data) {
						if (data[0].name) {
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#provinceId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
		});
        //地址选择
        $('.provinceSelect').change(function(){            
			
			if($('.provinceSelect option:selected')){
                $('#provinceSelectName').val($('.provinceSelect option:selected').attr("value"));
            }
			
			//清空所有子元素
			//if (parseInt($("#cityId").children().length) > 1) {
				$("#cityId").empty();
				$("#cityId").append('<option value="">请选择城市</option>');
			//}
			
			//清空所有子元素
			//if (parseInt($("#countyId").children().length) > 1) {
				$("#countyId").empty();
				$("#countyId").append('<option value="">请选择区县</option>');
			//}
			
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': 'CITY',
					 'areaParentCode': $('.provinceSelect option:selected').attr("value")}, 
					
					function(data) {
						if (data[0].name) {
							
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#cityId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
			
        });
        $('.citySelect').change(function(){
            
			if($('.citySelect option:selected')){
                $('.citySelectName').val($('.citySelectId option:selected').attr('value'));
            }

			//清空所有子元素
			//if (parseInt($("#countyId").children().length) > 1) {
				$("#countyId").empty();
				$("#countyId").append('<option value="">请选择区县</option>');
			//}
			
			$.get('$!utilWebconfig.getActionDefaultFontPath()/AREA/list', 
					{'areaType': 'COUNTY',
					 'areaParentCode': $('.citySelect option:selected').attr("value")}, 
					
					function(data) {
						if (data[0].name) {
							
							for (var i in data) {
								var code = data[i].code;
								var name = data[i].name;
								var optionHTML = '<option value="'+ code +'">'+name+'</option>';
								$("#countyId").append(optionHTML);
							}
							provinceFlag = true;
						} else {
							layer.alert('操作失败', {
								icon: 2,
								time: 2000
							}, function() {
								
							});
						}
					});
			
        });
	
        $('.countySelect').change(function(){
            
			if($('.countySelect option:selected')){
                $('.countySelectName').val($('.countySelectId option:selected').attr('value'));
            }
						
        });	    

    	$(document).delegate('#logoUrlUploadFile','change',function(){
            $.ajaxFileUpload
            (
                    {
                 		url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'logoUrlUploadFile', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                               
                                $('#logoUrlUploadFileReturnInput').val(data.data);
                                $('#logoUrlUploadFileReturnImg').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
        
        
        $(document).delegate('#logoUrlUploadFile1','change',function(){
            $.ajaxFileUpload
            (
                    {
                 		url: '/upload/file', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'logoUrlUploadFile1', //文件上传域的ID
                        dataType: 'json', //返回值类型 一般设置为json
                        success: function (data,status)  //服务器成功响应处理函数
                        {
                            if(data && data.status==200){
                             
                                $('#logoUrlUploadFileReturnInput1').val(data.data);
                                $('#logoUrlUploadFileReturnImg1').attr('src',tfsPath + data.data);

                            }else{
                                layer.alert('上传失败');
                            }
                        },
                        error: function (data)//服务器响应失败处理函数
                        {
                            layer.alert('服务器异常');
                        }
                    }
            )
        });
		
		
		$('#btnSubmit').click(function(){

                // 房间设施 roomFacility
                var facilityId = 1;
                var roomFacilityStr = '';
                while (true) {

                    if ($("#roomFacility"+facilityId).length == 0) {
                        facilityId = 1;
                        break;
                    } else {
                        roomFacilityStr += $("#roomFacility"+facilityId).val();
                        facilityId ++;
                    }

                }

                $("#roomFacilityStrId").attr('value', roomFacilityStr);

                // 特色服务 roomService
                var roomServiceStr = '';
                while (true) {

                    if ($("#roomService"+facilityId).length == 0) {
                        facilityId = 1;
                        break;
                    } else {
                        roomServiceStr += $("#roomService"+facilityId).val();
                        facilityId ++;
                    }                    

                }

                $("#roomServiceStrId").val(roomServiceStr);

                // 酒店设施 roomFacility
                var hotelFacilityStr = '';
                while (true) {

                    if ($("#hotelFacility"+facilityId).length == 0) {
                        facilityId = 1;
                        break;
                    } else {
                        hotelFacilityStr += $("#hotelFacility"+facilityId).val();
                        facilityId ++;
                    }                    

                }

                $("#hotelFacilityStrId").val(hotelFacilityStr);

                var actionUrl;
                var hotelId = $('#hotelForm').attr('hotelId');
                if (hotelId) {
                    actionUrl = actionDefaultPath + '/B2C/hotelManage/edit/' + $('#hotelForm').attr('hotelId');
                } else {
                    actionUrl = actionDefaultPath + '/B2C/hotelManage/add';
                }
                $('#hotelForm').attr('action', actionUrl);
                //$('#hotelForm').submit();


        });
    });
</script>