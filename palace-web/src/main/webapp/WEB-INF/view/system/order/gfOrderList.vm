<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css"
      rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js"
        type="text/javascript"></script>
<div>
    <form class="form-signin" id="tradeListForm" name="tradeListForm"
          action="$!utilWebconfig.getActionDefaultFontPath()/B2C/orderManage/gfOrderList" method="GET" role="form">
        <div class="inputGroup whole">
            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">订单编号</button>
                    </span>
                <input type="text" class="form-control" name="orderNO" value="$!orderListQuery.orderNO">

            </div>
            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">订单日期</button>
                    </span>
                <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="beginDate"
                       value="$!orderListQuery.beginDate">
                <span class="input-group-addon fix-border fix-padding dateInpCenter">至</span>
                <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="endDate"
                       value="$!orderListQuery.endDate">
            </div>

            <div class="input-group inpSingle ">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">订单状态</button>
                    </span>
                <select data-placeholder="请选择..." class="chosen-select form-control " tabindex="2" name="orderStat">
                    <option value="0">全部</option>
                    <option value="NOT_PAY" #if($!orderListQuery.orderStat == 'NOT_PAY') selected #end>未付款</option>
                    <option value="PAID" #if($!orderListQuery.orderStat == 'PAID') selected #end>待发货/已付款</option>
                    <option value="REFUNDED" #if($!orderListQuery.orderStat == 'REFUNDED') selected #end>退款后交易关闭</option>
                    <option value="SUCCESS" #if($!orderListQuery.orderStat == 'SUCCESS') selected #end>交易成功</option>
                    <option value="NOT_PAY_CLOSE" #if($!orderListQuery.orderStat == 'NOT_PAY_CLOSE') selected #end>未付款关闭</option>
                    <option value="WAIT_BUSINESS_CONFIRM" #if($!orderListQuery.orderStat == 'WAIT_BUSINESS_CONFIRM') selected #end>待商户确认</option>
                </select>
            </div>

            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">商品名称</button>
                    </span>
                <input type="text" class="form-control" name="itemName" value="$!orderListQuery.itemName">
            </div>

            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">买家手机号</button>
                    </span>
                <input type="text" class="form-control" name="buyerPhone" value="$!orderListQuery.buyerPhone">
            </div>

            <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">买家昵称</button>
                    </span>
                <input type="text" class="form-control" name="buyerName" value="$!orderListQuery.buyerName">
            </div>

            <div class="btn-group">
                <button type="submit" class="btn btn-primary">查询</button>
            </div>
            <div class="btn-group">
                <button type="button" id="clean_btn" class="btn btn-primary">重置</button>
            </div>

        </div>
        <div class="tableGroup whole">
            <table class="table table-hover">
            <tbody>
                <tr>
                    <th><input class="allChecked" name="allChecked" type="checkbox">全选</th>
                    <th>商品</th>
                    <th>单价</th>
                    <th>数量</th>
                    <th>买家</th>
                    <th>交易状态</th>
                    <th>订单金额</th>
                    #* <th>操作</th> *#
                </tr>
                #foreach($order in $orderList)
                    <tr></tr>
                    <tr>
                        <td><input class="subChecked" type="checkbox" value="$!order.bizOrderDO.bizOrderId"></td>
                        <td colspan="8" align="left">

                            订单编号：$!order.bizOrderDO.bizOrderId &nbsp;&nbsp;&nbsp;&nbsp;下单时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrderDO.gmtCreated)
                        </td>
                    </tr>

                    #foreach($subOrder in $order.subOrderList)
                    <tr>
                        <td></td>
                        <td>
                            <div class="goods-item">
                                <div class="t-img">
                                    <img class="uploadImgFile" src="$!{utilWebconfig.getTfsRootPath()}$!subOrder.bizOrderDO.itemPic">
                                </div>
                                <div class="t-msg">
                                    <div class="t-name">$!subOrder.bizOrderDO.itemTitle</div>
                                    #if($!subOrder.startTime != 0 || $!subOrder.endTime != 0)
                                        <div class="t-date">开始日期：$!date.format('yyyy-MM-dd',$!subOrder.startTime)</div>
                                        <div class="t-date">结束日期：$!date.format('yyyy-MM-dd',$!subOrder.endTime)</div>
                                    #end
                                    <div class="t-userType">$!subOrder.bizOrderDO.itemSubTitle</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="order-price">
                                $!utilNum.moneyTransform($!subOrder.bizOrderDO.itemPrice)
                            </div>
                        </td>

                        <td>
                            <div class="order-number">
                                $!subOrder.bizOrderDO.buyAmount
                            </div>
                        </td>
                    #end
                        <td>
                            <div>
                                <div class="txt">id:$!order.user.id</div>
                                <div class="txt">
                                    #if($!order.user.nickname)
                                        nickName:$!order.user.nickname
                                    #end
                                </div>
                                <div class="txt">mobile:$!order.user.mobileNo</div>
                            </div>
                        </td>
                        <td>
                            <div class="">
                                #ORDERS_STATUS($!order.orderShowState)
                            </div>
                        </td>
                        <td>
                            <div>
                                $!utilNum.moneyTransform($!order.bizOrderDO.actualTotalFee)
                            </div>
                        </td>
                        <td>
                            <button type="button" class="btn btn-primary addRefund detail" orderId="$!order.bizOrderDO.bizOrderId">详情</button>
                            #if($order.orderShowState == 2)
                                <button type="button" class="btn btn-primary affirm"
                                        data-target="#affirmModal" orderId="$!order.bizOrderDO.bizOrderId">确认
                                </button>
                            #elseif($order.orderShowState == 3)
                                <button type="button" class="btn btn-primary finish"
                                        data-target="#finishModal" orderId="$!order.bizOrderDO.bizOrderId">完成
                                </button>
                            #elseif($order.bizOrderDO.refundStatus != 4 && $order.bizOrderDO.payStatus == 2)
                                <button type="button" class="btn btn-primary refund"
                                        data-target="#refundModal" orderId="$!$!order.bizOrderDO.bizOrderId">退款
                                </button>
                            #end
                        </td>
                </tr>
                #end
            </tbody>
            </table>
        </div>
    #*分页*#
        #parse("/page.vm")
        #pageStyle("tradeListForm")
    </form>

    </div>

</div>
<script>
    //全选
    $('.allChecked').click(function(){
        $('.subChecked').prop('checked',$(this).prop('checked'));
    });

    $(".form-date").datetimepicker(
            {
                language: "zh-CN",
                weekStart: 1,
                todayBtn: 1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                minView: 2,
                forceParse: 0,
                format: "yyyy-mm-dd"
            });

    $(function () {
        $(".detail").click(function () {
            var orderId = $(this).attr("orderId");
            window.parent.tabsAdd('', actionDefaultPath + "/B2C/orderManage/gfOrder/"+orderId, 2, "GF订单详情");
        });


        $('.finish').each(function(){
            $(this).click(function(){
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/buyerConfirmGoods/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });
        });

        $('.refund').each(function(){
            $(this).click(function(){
                $(this).prop('disabled',true);
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/refundOrder/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });
        });

        $('.affirm').each(function(){
            $(this).click(function(){
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/sellerSendGoods/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });
        });
    });

    $("#clean_btn").click(function(){
        $('#tradeListForm div:eq(0)').find('input').val("").end().find('select')[0].selectedIndex = 0;
        //$('#tradeListForm div:eq(0)').find('select')[0].selectedIndex = 0;
    });
</script>