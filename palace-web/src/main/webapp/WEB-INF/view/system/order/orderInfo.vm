<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css"
      rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js"
        type="text/javascript"></script>

<style type="text/css">
	.lType {
	    font-family: "Arial Negreta","Arial";
	    font-size: 16px;
	    font-style: normal;
	    font-weight: 700;
	}
</style>       

<div>
    <!-- 位置 -->
    <div class="position">
        <div>您所在的位置： 订单管理>商品订单>订单详情</div>
    </div>
    <br><br>
    <!-- 订单状态 -->
    <div class="orderState">
        <div>
			<span class="lType">订单状态：<span>
	            #if($order.bizOrder.orderType == 3100 || $order.bizOrder.orderType == 3200 || $order.bizOrder.orderType == 3300 || $order.bizOrder.orderType == 200 
	            || $order.bizOrder.orderType == 3500 || $order.bizOrder.orderType == 3600)
		            #if($order.bizOrder.orderStatus == 2)
		                <span>
		                   	 待付款；
		                </span>
		                <span>
		                   	 下单时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.createTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 3)
		                <span>
		                    	处理中；
		                </span>
		                <span>
		                   	 付款时间：#if($!order.bizOrder.payTime > 0)$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.payTime)#end
		                </span>
		                <span>
		                    <button type="button" class="btn btn-primary affirm"
		                            data-target="#affirmModal" orderId="$!order.bizOrder.bizOrderId">确认
		                    </button>
		                </span>
		            #elseif($order.bizOrder.orderStatus == 6)
		                <span>
		                  	  待出行；
		                </span>
		                <span>
		                    $!order.deliveryTime
		                  	  确认时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.deliveryTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 10)
		                <span>
		                    	已完成;
		                </span>
		                <span>
		                   	 完成时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 8)
		                <span>
		                    	已取消;
		                </span>
		                <span>
		                   	 取消时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		                <span>
		                   	 取消原因：$!order.closeReason
		                </span>
		            #end
		            
		    #elseif($order.bizOrder.orderType == 1200)
		    		 #if($order.bizOrder.orderStatus == 2)
		                <span>
		                   	 待付款；
		                </span>
		                <span>
		                   	 下单时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.createTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 3)
		                <span>
		                    	待确认；
		                </span>
		                <span>
		                   	 付款时间：#if($!order.bizOrder.payTime > 0)$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.payTime)#end
		                </span>
		                <span>
		                    <button type="button" class="btn btn-primary affirm"
		                            data-target="#affirmModal" orderId="$!order.bizOrder.bizOrderId">确认
		                    </button>
		                </span>
		            #elseif($order.bizOrder.orderStatus == 6)
		                <span>
		                  	  待使用；
		                </span>
		                <span>
		                    $!order.deliveryTime
		                  	  确认时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.deliveryTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 10)
		                <span>
		                    	已完成;
		                </span>
		                <span>
		                   	 完成时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 8)
		                <span>
		                    	已取消;
		                </span>
		                <span>
		                   	 取消时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		                <span>
		                   	 取消原因：$!order.closeReason
		                </span>
		            #end
		            
		     #elseif($order.bizOrder.orderType == 1100)
		    		 #if($order.bizOrder.orderStatus == 2)
		                <span>
		                   	 待付款；
		                </span>
		                <span>
		                   	 下单时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.createTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 3)
		                <span>
		                    	待确认；
		                </span>
		                <span>
		                   	 付款时间：#if($!order.bizOrder.payTime > 0)$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.payTime)#end
		                </span>
		                <span>
		                    <button type="button" class="btn btn-primary affirm"
		                            data-target="#affirmModal" orderId="$!order.bizOrder.bizOrderId">确认
		                    </button>
		                </span>
		            #elseif($order.bizOrder.orderStatus == 6)
		                <span>
		                  	  预订成功；
		                </span>
		                <span>
		                    $!order.deliveryTime
		                  	  确认时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.deliveryTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 10)
		                <span>
		                    	已完成;
		                </span>
		                <span>
		                   	 完成时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 8)
		                <span>
		                    	已取消;
		                </span>
		                <span>
		                   	 取消时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		                <span>
		                   	 取消原因：$!order.closeReason
		                </span>
		            #end
		            
		       #elseif($order.bizOrder.orderType == 3400)
		    		 #if($order.bizOrder.orderStatus == 3)
		                <span>
		                    	待确认；
		                </span>
		                <span>
		                   	 付款时间：#if($!order.bizOrder.payTime > 0)$!date.format('yyyy-MM-dd HH:mm:ss',$!order.bizOrder.payTime)#end
		                </span>
		                <span>
		                    <button type="button" class="btn btn-primary affirm"
		                            data-target="#affirmModal" orderId="$!order.bizOrder.bizOrderId">确认
		                    </button>
		                </span>
		            #elseif($order.bizOrder.orderStatus == 6)
		                <span>
		                  	  预订成功；
		                </span>
		                <span>
		                    $!order.deliveryTime
		                  	  确认时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.deliveryTime)
		                </span>
		             #elseif($order.bizOrder.orderStatus == 11)
		                <span>
		                  	  未入住；
		                </span>
		                <span>
		                    $!order.deliveryTime
		                  	  确认时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.deliveryTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 10)
		                <span>
		                    	已完成;
		                </span>
		                <span>
		                   	 完成时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		            #elseif($order.bizOrder.orderStatus == 8)
		                <span>
		                    	已取消;
		                </span>
		                <span>
		                   	 取消时间：$!date.format('yyyy-MM-dd HH:mm:ss',$!order.completionTime)
		                </span>
		                <span>
		                   	 取消原因：$!order.closeReason
		                </span>
		            #end
		   		#end
            <span>
        </div>
    </div>
    <br><br>
    <!--备注 -->
     <div class="buyerInfo">
     	<div class="lType">备注</div>
        <div>买家备注：#if("$!order.otherInfo" == "") 无 #else $!order.otherInfo  #end</div>
        <div>卖家备注：#if("$!sellerMsg" == "") 无 #else $!sellerMsg  #end</div>
    </div>
    <br><br>
    <!-- 买家信息 -->
    <div class="buyerInfo">
    	<div class="lType">卖家信息</div>
        <div>
        	#if("$!talent" != "")  
        	<span>昵称：$!talent</span>
        	#end
        	
        	#if("$!merchant" != "")  
        	<span>店铺名称：$!merchant</span>
        	#end
        </div>
        
        <div class="lType">买家信息</div>
        <div>
            <span>手机号：$!phone</span>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp    
            <span>昵称：$!order.bizOrder.buyerNick</span>
        </div>
    </div>
    <br><br>
    <!-- 订单基础信息 -->
    <div #*class="orderBaseInfo" *#>
        <div class="lType">订单基础信息</div>
        <table class="table table-hover">
            <tr>
                <td>订单编号：</td>
                <td>$!order.bizOrder.bizOrderId</td>
                <td>下单时间：</td>
                <td>$!{utilDate.date2String($!{utilDate.longToDate($order.bizOrder.createTime)})}</td>
                <td>出发日期：</td>
                <td> $!date.format('yyyy-MM-dd',$!startDate)</td>
            </tr>
            <tr>
                <td>付款时间：</td>
                <td>$!{utilDate.date2String($!{utilDate.longToDate($order.bizOrder.payTime)})}</td>
                <td>付款方式：</td>
                <td>
	                #if("$!order.payChannel" == "0") 支付宝条码  
	                #elseif("$!order.payChannel" == "2") 支付宝网页 
	                #elseif("$!order.payChannel" == "3") 支付宝手机 
	                #elseif("$!order.payChannel" == "4") 微信支付
	                 #end
                 </td>
            </tr>
        </table>
    </div>
    <br><br>
    <!-- 联系人信息 -->
    <div class="contacts">
        <div class="lType">联系人信息</div>
        <table class="table table-hover">
            <tr>
                <th>姓名</th>
                <th>手机号</th>
            </tr>
            <tr>
                <td>$!order.contactInfo.contactName</td>
                <td>$!order.contactInfo.contactPhone</td>
            </tr>
        </table>
    </div>
    <br><br>
    <!-- 出行人信息 -->
    <div class="turistInfo">
        <div class="lType">出行人信息</div>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>序号</th>
                <th>姓名</th>
                <th>手机号</th>
                <th>证件号</th>
            </tr>
                #foreach($tourist in $order.touristList)
                <tr>
                    <td>$velocityCount</td>
                    <td>$!tourist.contactName</td>
                    <td>$!tourist.contactPhone</td>
                    <td>
                    	#if($!tourist.certificatesType == 1 )
	               		     身份证
	               		#elseif($!tourist.certificatesType == 2 )
	               		护照
	               		#elseif($!tourist.certificatesType == 3 )
	               		军人证
	               		#elseif($!tourist.certificatesType == 4 )
	               		港澳通行证
	               		#end
	               		
                   	 	$!tourist.certificatesNum
                   	</td>
                </tr>
                #end
        </table>
    </div>
    <br><br>
    <!-- 订单商品信息 -->
    <div class="orderInfo">
        <div class="lType">订单商品信息</div>
        <div>
            <span>订单总额：￥$!utilNum.moneyTransform($!order.totalFee)</span>
        </div>
        <table class="table table-hover">
            <tr>
                <th colspan="2">商品</th>
                <th>单价</th>
                <th>数量</th>
                <th>交易状态</th>
            </tr>
            #foreach($subOrder in $order.detailOrders)
                <tr>
                    <td></td>
                    <td>
                        <div class="goods-item">
                            <div class="t-img">
                                <img class="uploadImgFile" src="$!{utilWebconfig.getTfsRootPath()}$!subOrder.itemPic">
                            </div>
                            <div class="t-msg">
                            	#if($!subOrder.bizOrder.orderType == 3100 ||$!subOrder.bizOrder.orderType == 3200 || $!subOrder.bizOrder.orderType == 3300 || $!subOrder.bizOrder.orderType == 200 
                            	|| $!subOrder.bizOrder.orderType == 3500 || $!subOrder.bizOrder.orderType == 3600)
                                   	<div class="t-name">$!subOrder.itemTitle</div>
                                    <div class="t-date">$!date.format('yyyy-MM-dd',$!subOrder.startDate) 出发</div>
                                    <div class="t-userType">$!subOrder.itemSubTitle</div>
                                    <div class="t-userType">$!subOrder.personType</div>
                                #end
                                
                                #if($!subOrder.bizOrder.orderType == 1200 )
                                	<div class="t-name">$!order.scenicTitle</div>
                                	<div class="t-name">$!subOrder.itemTitle</div>
                                    <div class="t-date">$!date.format('yyyy-MM-dd',$!order.scenicEnterTime) 入园</div>
                                    <div class="t-userType">$!order.ticketTitle</div>
                                #end
                                
                                 #if($!subOrder.bizOrder.orderType == 1100 || $!subOrder.bizOrder.orderType == 3400)
                                	<div class="t-name">$!order.hotelTitle</div>
                                	<div class="t-name">$!subOrder.itemTitle</div>
                                    <div class="t-date">$!date.format('yyyy-MM-dd',$!subOrder.startDate)</div>
                                    <div class="t-userType">$!order.roomTitle</div>
                                    #if($!subOrder.bizOrder.orderType == 1400)
                                    	<div class="t-userType">在线付</div>
                                    #elseif($!subOrder.bizOrder.orderType == 3400)
                                    	<div class="t-userType">到店付</div>
                                    #end
                                #end
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="order-price">
                            $!utilNum.moneyTransform($!subOrder.itemPrice)
                        </div>
                    </td>
                    <td>
                        <div class="order-number">
                            $!subOrder.bizOrder.buyAmount
                        </div>
                    </td>
                    <td>
                        <div class="">
                            #if($!subOrder.bizOrder.orderType == 3100 || $!subOrder.bizOrder.orderType == 3200 
                             	|| $!subOrder.bizOrder.orderType == 3300 || $!subOrder.bizOrder.orderType == 200 
                             	|| $!subOrder.bizOrder.orderType == 3500 || $!subOrder.bizOrder.orderType == 3600)
                            	    #if($subOrder.bizOrder.orderStatus == 2)
                                  		待付款
                                    #elseif($subOrder.bizOrder.orderStatus == 3)
                                       	 处理中
                                    #elseif($subOrder.bizOrder.orderStatus == 6)
                                      	  待出行
                                    #elseif($subOrder.bizOrder.orderStatus == 10)
                                      	  已完成
                                    #elseif($subOrder.bizOrder.orderStatus == 8)
                                       	 已取消
                                    #end
                            #elseif($!subOrder.bizOrder.orderType == 1200)
                               		#if($subOrder.bizOrder.orderStatus == 2)
                                  		待付款
                                    #elseif($subOrder.bizOrder.orderStatus == 3)
                                       	待确认
                                    #elseif($subOrder.bizOrder.orderStatus == 6)
                                      	  待使用
                                    #elseif($subOrder.bizOrder.orderStatus == 10)
                                      	  已完成
                                    #elseif($subOrder.bizOrder.orderStatus == 8)
                                       	 已取消
                                    #end
                            #elseif($!subOrder.bizOrder.orderType == 1100 || $!subOrder.bizOrder.orderType == 3400)
                            		#if($subOrder.bizOrder.orderStatus == 2)
                                  		待付款
                                    #elseif($subOrder.bizOrder.orderStatus == 3)
                                       	待确认
                                    #elseif($subOrder.bizOrder.orderStatus == 6)
                                      	 预订成功
                                    #elseif($subOrder.bizOrder.orderStatus == 10)
                                      	  已完成
                                    #elseif($subOrder.bizOrder.orderStatus == 8)
                                       	 已取消
                                    #elseif($subOrder.bizOrder.orderStatus == 11)
                                       	 未入住
                                    #end
                            #end
                        </div>
                    </td>
                </tr>
            #end
        </table>
    </div>



    <!-- 退款模态框 -->
    <div class="modal fade" id="refundModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span
                            class="sr-only">关闭</span></button>
                    <h4 class="modal-title">对话框标题</h4>
                </div>
                <div class="modal-body dialogPoint">
                    <form class="form-signin" id="refundAddForm" action="/refundManage/add" method="POST" role="form">
                        <div class="form-group">
                            <ul class="formPoint">
                                <li> 退款金额：￥86.00 退款路径：支付宝/微信/银联</li>
                                <li>
                                    <label for="refundMoney">退款金额</label>
                                    <input id="refundMoney" type="text" class="form-control refundMoney"
                                           placeholder="退款金额" name="refundMoney" value="">
                                </li>
                                <li>
                                    <label for="shouldRefundPoint">需返还积分</label>
                                    <input type="text" class="form-control shouldRefundPoint pointShow"
                                           placeholder="需返还积分" name="shouldRefundPoint" value="" readonly="">
                                </li>
                                <li>
                                    <label for="availablePoint">可返还积分</label>
                                    <input type="text" class="form-control availablePoint pointShow" placeholder="可返还积分"
                                           name="availablePoint" value="" readonly="">
                                </li>
                            </ul>
                            <button id="btnSubmit" class="btn btn-large btn-block btn-primary" type="button"
                                    disabled="">提交
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        $(function () {
            $(".finish").click(function(){
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/buyerConfirmGoods/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });


            $('.refund').each(function(){
                $(this).click(function(){
                    $(this).prop('disabled',true);
                    $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/refundOrder/',{'orderId':$(this).attr('orderId')} ,function(data){
                        if(data.status == 200){
                            var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                            msg.show();
                        }else{
                            var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                            msg.show();
                        }
                        //TODO暂时先刷新页面
                        setTimeout(function(){
                            window.location.href = window.location.href;
                        },1050);
                    })
                });
            });

            $(".affirm").click(function(){
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/sellerSendGoods/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });


            //取消订单
            $(".cancel").click(function(){
                $.post('$!utilWebconfig.getActionDefaultFontPath()'+'/B2C/orderManage/closeOrder/',{'orderId':$(this).attr('orderId')} ,function(data){
                    if(data.status == 200){
                        var msg = new $.zui.Messager('操作成功', {placement: 'center',type:'success',time:'1000'});
                        msg.show();
                    }else{
                        var msg = new $.zui.Messager('操作失败', {placement: 'center',type:'warning',time:'1000'});
                        msg.show();
                    }
                    //TODO暂时先刷新页面
                    setTimeout(function(){
                        window.location.href = window.location.href;
                    },1050);
                })
            });

        });
    </script>
</div>