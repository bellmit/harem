<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css" rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js" type="text/javascript"></script>
<form class="form-signin" id="evaluationVOListForm" name="evaluationVOListForm" action="$!utilWebconfig.getActionDefaultFontPath()/B2C/evaluationManage/list" method="GET" role="form">
    <div class="inputGroup whole">
        <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">评价状态：</button>
                    </span>
            <select class="form-control" name="evaluationStatus">
                <option value="0" >全部</option>
                <option value="1" #if($!itemReviewListQuery.evaluationStatus == 1) selected #end>正常</option>
                <option value="2" #if($!itemReviewListQuery.evaluationStatus == 2) selected #end>违规</option>
            </select>
        </div>
        <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">评价日期：</button>
                    </span>
            <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="beginDate" value="$!itemReviewListQuery.beginDate">
            <span class="input-group-addon fix-border fix-padding dateInpCenter">至</span>
            <input type="text" class='form-control form-date dateInp' placeholder='' readonly name="endDate" value="$!itemReviewListQuery.endDate">
        </div>
        <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">商品编号：</button>
                    </span>
            <input type="text" class="form-control" name="nickName" value="$!itemReviewListQuery.nickName">
        </div>
        <div class="input-group inpSingle">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">评价ID：</button>
                    </span>
            <input type="text" class="form-control" name="tel" value="$!itemReviewListQuery.tel">
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary submitBtn">查询</button>
        </div>
        <div class="btn-group">
            <button type="reset" class="btn btn-primary">重置</button>
        </div>
    </div>
    <button type="button" class="btn btn-primary replayBatchBtn">批量回复</button>
    <button type="button" class="btn btn-primary deleteBatchBtn">批量删除</button>
    <div class="tableGroup whole">
        <table class="table table-hover">
            <thead>
            <tr>
                <th width="10%"><label><input class="allChecked" name="allChecked" type="checkbox">全选</label></th>
                <th width="20%">用户昵称</th>
                <th width="70%">用户手机号</th>
                <th width="10%">操作</th>
            </tr>
            </thead>
            <tbody>
                #foreach($itemReview in $itemReviewList)
                <tr class="subCheckedTR">
                    <td><input class="subChecked" type="checkbox" value="$!itemReview.id"></td>
                    <td>$!esc.html($!itemReview.userDO.nickname) touxiang </td>
                    <td>
                        <table>
                            <tbody>
                            <tr>
                                <td width="25%">评价日期:$!itemReview.gmtCreated</td>
                                <td width="25%">商品名称:$!itemReview.itemDO.name</td>
                                <td width="25%">订单编号:$!itemReview.orderId</td>
                                <td width="25%">商品编号:$!itemReview.itemId</td>
                            </tr>
                                #if ($!itemReview.content)
                                <tr>
                                    <td colspan="4">
                                        $!itemReview.content
                                    </td>
                                </tr>
                                #end
                                #if ($!itemReview.picUls)
                                <tr>
                                    <td colspan="4">
                                        #foreach($picUrl in $!itemReview.picUrls)
                                            <img src="$!picUrl"
                                        #end
                                    </td>
                                </tr>
                                #end
                                #if ($!itemReview.backContent)
                                <tr>
                                    <td colspan="4">
                                        $!itemReview.backContent
                                    </td>
                                </tr>
                                #end
                            </tbody>
                        </table>
                    </td>
                    <td>
                        <button type="button" class="btn btn-primary replayBtn"  evaluationId="$!itemReview.id" status="$!itemReview.status">#if($!itemReview.status == 1) 回复 #else 已删除 #end </button>
                    </td>
                </tr>
                #end
            </tbody>
        </table>
    </div>
    <!--
    shouye # http://m.gellefreres.com/wap/
    滴滴兑换 # http://m.gellefreres.com/wap/product_details.html?commodity=6346
    优惠券生成 # http://m.gellefreres.com/wap/add_coupon.html
     CREATE TABLE `com_rate` (
  `id` bigint(20) NOT NULL COMMENT '评价表 idgen',
  `domain` int(11) NOT NULL,
  `sku_id` bigint(20) NOT NULL,
  `item_id` bigint(20) NOT NULL,
  `seller_id` bigint(20) NOT NULL COMMENT '商家id',
  `order_id` bigint(20) NOT NULL COMMENT '订单编号',
  `order_type` tinyint(4) NOT NULL COMMENT '订单类型 ： 1.主订单 2.子订单',
  `out_id` bigint(20) NOT NULL,
  `out_type` tinyint(4) NOT NULL COMMENT '外部类型 1.酒店  2.景点  3.活动  4.线路 5.实物商品',
  `user_id` bigint(20) NOT NULL COMMENT '评论人id',
  `content` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '评论内容',
  `pic_urls` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '图片',
  `anony` tinyint(4) NOT NULL DEFAULT '2' COMMENT '是否匿名评价 1.是 2.否',
  `score` int(11) NOT NULL COMMENT '总分',
  `has_pic` int(11) NOT NULL COMMENT '是否有图 : 1.是 2.否',
  `rate_status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '评价状态： 1.评价  2.商家回复  3.追评',
  `feature` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '评分维度',
  `back_time` datetime DEFAULT NULL COMMENT '回复时间',
  `back_content` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '回复内容',
  `back_pics` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '回复图片',
  `add_time` datetime DEFAULT NULL COMMENT '追评时间',
  `add_content` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '追评内容',
  `add_pics` varchar(150) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '追评图片',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态:1 是 2 否',
  `version` int(11) DEFAULT '1',
  `gmt_created` datetime NOT NULL,
  `gmt_modified` datetime NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `index_orderid_domain` (`order_id`,`domain`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8
    -->
#*分页*#
    #parse("/page.vm")
    #pageStyle("evaluationVOListForm")
</form>
<script>
    $(".form-date").datetimepicker(
            {
                language:  "zh-CN",
                weekStart: 1,
                todayBtn:  1,
                autoclose: 1,
                todayHighlight: 1,
                startView: 2,
                minView: 2,
                forceParse: 0,
                format: "yyyy-mm-dd"
            });
    $(function(){
        //查询
        $('.submitBtn').click(function(){
            $('#evaluationVOListForm').submit();
        });
        $('.replayBtn').click(function () {
            alert('replay');
        });
        $('#deleteBatchBtn').click(function () {
            alert('deleteBatchBtn');
        })
        $('#replayBatchBtn').click(function () {
            alert('replayBatchBtn');
        })
        //单个启用停用
        $('.evaluationBtn').each(function(){
            $(this).click(function(){
                $(this).prop('disabled',true);
                var url = '';
                if($(this).attr('status') == 1){//状态1是正长状态，操作是改为违规
                    url = actionDefaultPath + '/GF/itemReviewManage/violation/' + $(this).attr('evaluationId');
                }else{
                    url = actionDefaultPath + '/GF/itemReviewManage/regain/' + $(this).attr('evaluationId');
                }
                $.post(url ,function(data){
                    if(data.status == 200){
                        layer.msg('操作成功', {
                            icon: 1,
                            time: 1500
                        });
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        },1500);
                    }else{
                        layer.msg('操作失败', {
                            icon: 2,
                            time: 2000
                        });
                        $(this).prop('disabled',false);
                    }
                })
            });
        });

        //全选
        $('.allChecked').click(function(){
            $('.subChecked').prop('checked',$(this).prop('checked'));
        });
        //单选
        $('.subCheckedTR').click(function(){
            $(this).find('.subChecked').prop('checked',!$(this).find('.subChecked').prop('checked'));
        });
        //批量违规
        $('.evaluationBatchBtn').click(function(){
            $(this).prop('disabled',true);
            var arr = new Array();
            $('.subChecked:checked').each(function(){
                arr.push($(this).val());
            });
            $.post(actionDefaultPath +'/B2C/evaluationManage/batchViolation',{evaluationIdList:arr},function(data){
                if(data&&data.status == 200){
                    layer.alert('操作成功', {
                        icon: 1,
                        time: 1500
                    });
                    setTimeout(function () {
                        window.location.href = window.location.href;
                    },1500);
                }else{
                    layer.alert('操作失败', {
                        icon: 2,
                        time: 2000
                    });
                    $(this).prop('disabled',false);
                }
            })
        });
    });



</script>