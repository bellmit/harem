<link href="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.css"
      rel="stylesheet">
<script src="$utilWebconfig.getStaticResourcesPath()/resources/zui/lib/datetimepicker/datetimepicker.min.js"
        type="text/javascript"></script>
<form id="mediaPageQuery" name="mediaPageQuery"
      action="$!utilWebconfig.getActionDefaultFontPath()/jiuxiu/attachmentManage/list">
    <div class="inputGroup">
        <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">文件名称：</button>
                </span>
            <input type="text" class="form-control" name="inputFileName" value="" id="inputFileName">
        </div>
        <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">格式</button>
                </span>
            <select class="form-control" name="fileType" id="fileType">
                <option value="0">全部</option>

                #foreach($mediaFileType in $mediaFileTypeList)
                    <option value="$!{mediaFileType.value}" #if($mediaPageQuery.fileType == $mediaFileType.value)
                            selected #end>$!{mediaFileType.desc}</option>
                #end
            </select>
        </div>
        <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">状态</button>
                </span>
            <select class="form-control" name="status" id="status">
                <option value="0">全部</option>
                #foreach($mediaFileStatus in $mediaFileStatusList)
                    <option value="$!{mediaFileStatus.value}" #if($mediaPageQuery.status == $mediaFileStatus.value)
                            selected #end>$!{mediaFileStatus.desc}</option>
                #end

            </select>
        </div>
        <div class="input-group inpSingle">
            <input type="text" class='form-control dateInp' placeholder='' readonly name="starteTime" value="">
            <span class="input-group-addon fix-border fix-padding dateInpCenter">至</span>
            <input type="text" class='form-control dateInp' placeholder='' readonly name="endTime" value="">
        </div>
        <div class="input-group inpSingle">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">用途：</button>
                </span>
            <select class="form-control" name="scope" id="scope">
                <option value="0">全部</option>
                #foreach($mediaFileScope in $mediaFileScopeList)
                    <option value="$!{mediaFileScope.value}" #if($mediaPageQuery.scope == $mediaFileScope.value)
                            selected #end>$!{mediaFileScope.desc}</option>
                #end
            </select>
        </div>
        <div class="btn-group">
            <button type="submit" class="btn btn-primary submitBtn">搜索</button>
        </div>
        <div class="btn-group">
            <button type="reset" class="btn btn-primary btn-clean">重置</button>
        </div>
    </div>
</form>
<form action="$utilWebconfig.getStaticResourcesPath()/jiuniu/attachmentManage/addAttachment"
      enctype="multipart/form-data" id="addAttachmentForm"
      name="addAttachmentForm" method="post">
    <div class="btnBottomMargin">
        <input type="file" name="file" class="file">
    </div>
    <div class="btnBottomMargin">
        <button type="submit" class="btn btn-primary upload">上传文件
        </button>
    </div>
</form>
<div class="tableGroup whole">
    <table class="table table-bordered table-hover" id="tbAttachmentList">
        <thead>
        <tr>
            <th>序号</th>
            <th>名称</th>
            <th>格式</th>
            <th>上传时间</th>
            <th>时长</th>
            <th>用途</th>
            <th>备注</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
            #foreach($item in $itemList)
            <tr>
                <td>$!{item.id}</td>
                <td>
                    $!{item.inputFileTitle}
                </td>
                <td>
                    $!{item.fileTypeStr}
                </td>
                <td>
                    $!utilDate.dateToString($!item.gmtCreated,"yyyy-MM-dd HH:mm:ss")
                </td>
                <td>$!{item.durationStr}</td>
                <td>
                    $!{item.scopeStr}
                </td>
                <td>$!{item.remark}</td>
                <td>
                    $!{item.statusStr}
                </td>
                <td>
                    <button type="button" class="btn btn-primary edit" itemId="$item.id">编辑</button>
                    <button type="button" class="btn btn-primary play" itemId="$item.id">播放</button>
                    <button type="button" class="btn btn-primary off" itemId="$item.id">下架</button>
                    <button type="button" class="btn btn-primary on" itemId="$item.id">上架</button>
                </td>
            </tr>
            #end
        </tbody>
    </table>
</div>
#*分页*#
#parse("/page.vm")
#pageStyle("tbAttachmentList")

<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/layerModal.js?version=21"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/upload.js?version=21"></script>
<script type="text/javascript">
    layer.config({
        extend: 'extend/layer.ext.js',
        extend: ['skin/mySkin/style.css'],
        skin: 'layer-ext-mySkin'
    });
    var openModalForAttachment = function (url, title, width, height) {// 弹出框url，标题，回调返回参数
        layer.open({
            type: 2,
            btn: ['确定', '取消'],
            title: title,
            fix: false,
            shadeClose: true,
            maxmin: true,
            area: [width, height],
            content: url,
            success: function (layero, index) {
                win = window[layero.find('iframe')[0]['name']];
            },
            yes: function (index) {
                layer.close(index);

            },
            cancel: function (index) {
                layer.close(index);
            }
        });
    }
    function submitEdit(data) {
        //alert(1);
        $.ajax({
            url: "$utilWebconfig.getStaticResourcesPath()/jiuxiu/attachmentManage/editAttachment",
            type: "post",
            data: data,
            success: function (res) {
                if (data.status == 200) {
                    layer.msg('操作成功', {
                        icon: 1,
                        time: 1500
                    });
                    setTimeout(function () {
                        window.location.href = window.location.href;
                    }, 1500);
                } else {
                    layer.msg('操作失败', {
                        icon: 2,
                        time: 2000
                    });
                    $(this).prop('disabled', false);
                }
            },
            error: function (xmlres, status, code) {
                layer.msg('操作失败', {
                    icon: 2,
                    time: 2000
                });
                $(this).prop('disabled', false);
            }
        });
    }
    $(function () {
        $("#tbAttachmentList").on("click", ".edit", function () {
            var id = $(this).attr('itemId');
            openModalForForm('$utilWebconfig.getStaticResourcesPath()/jiuxiu/attachmentManage/toEdit?id=' + id, "编辑音频信息", function () {
                var item = win.getItem();
                if (item != null) {
                    //alert(JSON.stringify(item))
                    submitEdit(item);
                }
                return true;
            });
        });
        $("#tbAttachmentList").on("click", ".play", function () {
            var id = $(this).attr('itemId');
            openModalForAttachment('$utilWebconfig.getStaticResourcesPath()/jiuxiu/attachmentManage/play?id=' + id, "播放", '500px', '300px');
        });
        $(".dateInp").datetimepicker({
            language: "zh-CN",
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0,
            format: "yyyy-mm-dd"
        });
    });
</script>

