<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/clubTable.css?version=$!{utilWebconfig.getResourceVersion()}"/>
<link rel="stylesheet" href="$utilWebconfig.getStaticResourcesPath()/resources/css/img-list.css"/>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/layerModal.js?version=$!{utilWebconfig.getResourceVersion()}"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/map.js?version=$!{utilWebconfig.getResourceVersion()}"></script>
<script src="$utilWebconfig.getStaticResourcesPath()/resources/js/upload.js?version=$!{utilWebconfig.getResourceVersion()}"></script>
<script charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.config.js"></script>
<script charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/ueditor.all.min.js"> </script>

<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="${utilWebconfig.getStaticResourcesPath()}/resources/ueditor/lang/zh-cn/zh-cn.js"></script>
<style type="text/css">
    .demo {
        width: 850px;
        margin: 20px auto;
        display: none;
    }

    #l-map {
        height: 400px;
        width: 600px;
        float: left;
        border: 1px solid #bcbcbc;
    }

    #r-result {
        height: 400px;
        width: 230px;
        float: right;
    }
    
    .imgWrap {
	    float: none;
	    margin-bottom: 5px;
	    padding-top: 5px;
	 }
</style>
<form name="addRoom" id="roomForm" action="" method="post" hotelId="$!hotelId">
<div class="tab-content grogInfoWrap"  style="">
    <div class="createHotrlTable">
        <table class="table">
			<tbody>
           <tr>
                <td><span class="spColor">*</span>房型名称</td>
                <td>
					#set($roomVOId=0)
                	#if($room.id)
                		#set($roomVOId=$room.id)
                	#end
                	<input type="hidden" id="roomId" name="id" value="$!{roomVOId}">
                    <input type="text" class="inpCtlBlock" name="name" 
                    	#if($room.id)
                    		disabled="disabled" 
                    	#end
                    placeholder="请填写房型全称，1-20个字" maxlength="20" value="$!{room.name}">
				</td>
            </tr>
            <tr>
                <td><span class="spColor">*</span>床型</td>
                <td>
                    <input type="text" class="inpCtlBlock" name="bed" value="$!room.bed">
                </td>
            </tr>
            <tr>
            	<td><span class="spColor">*</span>面积</td>
                <td>
                	<input type="text" class="inpCtlBlock" name="area" value="$!room.area">
                </td>
            </tr>
            <tr>
            	<td><span class="spColor">*</span>网络</td>
                <td>
                	#foreach($!net in $!network)
						<input type="checkbox" class="network" value="$net.type"
						#foreach($!net2 in $!room.networkList)
							$net
							#if($net.type == $net2)
								checked
							#end
						#end
						/>$net.desc
					#end
					<input type="hidden" id="networkStr" name="networkStr" value="" />
                </td>
            </tr>
            <tr>
            	<td>是否有窗</td>
                <td>
                	#foreach($!win in $!window)
						<input type="radio" name="window" value="$win.type" #if($!room.window == $win.type) checked #end  />$win.desc	
					#end
                </td>
            </tr>
            <tr>
            	<td>加床</td>
                <td>
                	#foreach($!bed in $!extraBed)
						<input type="radio" name="extraBed" value="$bed.type" #if($!room.extraBed == $bed.type) checked #end />$bed.desc	
					#end
                </td>
            </tr>
            <tr>
            	<td>楼层</td>
                <td>
                	<input type="text" class="inpCtlBlock" name="floor" value="$!room.floor">
                </td>
            </tr>
            <tr>
            	<td>最大可住人数</td>
                <td>
		            <select class="form-control" name="people">
	                    <option value="0"  >全部</option>
	                    <option value="1" #if($!room.people == 1) selected="selected" #end >1</option>
	                    <option value="2" #if($!room.people == 2) selected="selected" #end >2</option>
	                    <option value="3" #if($!room.people == 3) selected="selected" #end >3</option>
	                    <option value="4" #if($!room.people == 4) selected="selected" #end >4</option>
	                    <option value="5" #if($!room.people == 5) selected="selected" #end >5</option>
	                    <option value="6" #if($!room.people == 6) selected="selected" #end >6</option>
	                    <option value="7" #if($!room.people == 7) selected="selected" #end >7</option>
	                    <option value="8" #if($!room.people == 8) selected="selected" #end >8</option>
	                    <option value="9" #if($!room.people == 9) selected="selected" #end >9</option>
		            </select>
                </td>
            </tr>
            <tr>
			   <td><span class="spColor">*</span>房型图片</td>
			   <td>
			       <div id="room" class="imgWrap fileImgWrap">
                		<div class="upload-btn-wrap">
							<button type="button" class="btn btn-success">上传图片</button>
							<input id="roomUploadBtn" type="file" multiple="multiple" class="fileInp" style="margin-top:-15px;">
						</div>
                        #foreach($pic in ${room.pics})
                        	<div class="pic-wrap roomPicWrap">
								<img class="picUrlsUrl uploadImgFile dimg2" imgUrl="$!{pic}" src="$utilWebconfig.getTfsRootPath()$!{pic}" />
								<button type="button" class="btn btn-del-pic roomBtnDelPic" style="display:none;width:116px;">删除</button>
							</div>		
                        #end
                    </div>
                    <input class="roomPics" type="hidden" name="picListStr" value="">
                    <label class="roomPicsTip" style="display:none;">最少上传一张景区图片</label>
			   </td>
            </tr>
			</tbody>
        </table>
    </div>
    <button type="button" class="btn btn-info" id="btnSubmit">保存</button>
</div>
</form>
<script charset="utf-8" src="$utilWebconfig.getStaticResourcesPath()/resources/js/img-list.js"></script>
<script>
	
    //验证
    var validate = function(){
        if(!$('.name').val()){
            return '酒店名称不能为空';
        }else if($('.name').val().length > 20){
            return '酒店名称不能超过20个字';
        }
        if(!$('.provinceSelect').val() || $('.provinceSelect').val() == '0'){
            return '省份不能为空';
        }
        if(!$('.citySelect').val() || $('.citySelect').val() == '0'){
            return '城市不能为空';
        }
        if(!$('.countySelect').val() || $('.countySelect').val() == '0'){
            return '地区不能为空';
        }
        if($('.locationText').val() && $('.locationText').val().length > 30){
            return '区域地址不能超过30个字';
        }
        if(!$('#locationX').val() || !$('#locationY').val() || !/^[0-9]+.?[0-9]*$/.test($('#locationX').val()) || !/^[0-9]+.?[0-9]*$/.test($('#locationY').val())){
            return '地址经纬度格式不正确';
        }
        if($('.phoneNumListStr').val() && $('.phoneNumListStr').val().length > 30){
            return '酒店电话不能超过30个字';
        }
        if(!$('#grogDescr').val()){
            return '酒店简介不能为空';
        }else if($('#grogDescr').val().length > 500){
            return '酒店简介不能超过500个字';
        }
        if(!$('.oneword').val()){
            return '特色描述不能为空';
        }else if($('.oneword').val().length > 80){
            return '特色描述不能超过80个字';
        }
        if(!$('.priceY').val() || !/^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/.test($('.priceY').val())){
            return '基础价格最多保留两位小数的正数';
        }
        if($('.contactPerson').val() && $('.contactPerson').val().length > 20){
            return '酒店联系人姓名不能超过20个字';
        }
        if($('.contactPhone').val() && $('.contactPhone').val().length > 20){
            return '酒店联系人电话不能超过20个字';
        }
        if($('.facilityCl:checked').length <= 0){
            return '房间设施不能为空';
        }
        if(!$('.openTime').val()){
            return '入离时间不能为空';
        }else if($('.openTime').val().length > 50){
            return '入离时间不能超过50个字';
        }
        if($('.needKnow').length <= 0){
            return '入住须知不能为空';
        }else{
            var msg;
            $('.needKnow').each(function(){
                if(!$(this).find('.extra-info-item-title').val() || !$(this).find('.extra-info-item-text').val()){
                    msg = '入住须知不能为空';
                }else if($(this).find('.extra-info-item-title').val().length > 10){
                    msg = '入住须知标题不能超过10个字';
                }else if($(this).find('.extra-info-item-text').val().length > 500){
                    msg = '入住须知内容不能超过500个字';
                }
                return;
            });
            if(msg){
                return msg;
            }
        }
        if($('.recommend_description').val() && $('.recommend_description').val().length > 300){
            return '大咖推荐理由不能超过300个字';
        }
        if(!$('#logoUrlUploadFileReturnImg').attr('src')){
            return '列表页展示图不能为空';
        }
        if($('.hotelPicUrlsTd .uploadImgFile').length <= 0){
            return '详情页展示图不能为空';
        }
    }
    //表单验
    
    $(function(){
        
        var room = new ImgList("room", tfsRootPath, 4);
        
		$('#btnSubmit').click(function(){
            //非空验证
            /**
            var msg = validate();
            if(msg){
                layer.msg(msg, {
                    icon: 2,
                    time: 2000
                });
                return false;
            }
            **/
            
            var roomUrls = room.getPicUrls();
        	if(roomUrls.length > 0){
        		$('.roomPics').val(roomUrls.join("|"));
        	}
        	
        	var networkArr = [];
        	$(".network:checked").each(function(){
        		networkArr.push($(this).val());
        	});
        	
        	$("#networkStr").val(networkArr.join("|"));
        	
            var roomId = $('#roomId').val();
            var hotelId = $('#roomForm').attr('hotelId');
            var actionUrl;
            if (roomId != 0) {
                actionUrl = actionDefaultPath + '/jiuniu/hotelManage/editRoom/' + roomId;
            } else {
                actionUrl = actionDefaultPath + '/jiuniu/hotelManage/addRoom?hotelId='+ hotelId;
            }
            
            var options = {
                url: actionUrl,
                type: "post",
                dataType: "json",
                success: function (data) {
                    if (data.status == 200) {
						layer.alert('保存成功', {
			                time: 0 //不自动关闭
			                ,yes: function(index){
								window.location.href = "$!{utilWebconfig.getActionDefaultFontPath()}/jiuniu/hotelManage/roomList/"+ hotelId; 
			                }
			            });
                    } else {
                        layer.msg('操作失败', {
                            icon: 2,
                            time: 2000
                        });
                    }
                }
            };

            $("#roomForm").ajaxSubmit(options);
        });
    });
</script>